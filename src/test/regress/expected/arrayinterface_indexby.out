-- FOR VARRAY INTERFACE --
-- check compatibility --
show sql_compatibility;  -- expect A --
 sql_compatibility 
-------------------
 A
(1 row)

-- create new schema --
drop schema if exists plpgsql_array_interface_indexby;
NOTICE:  schema "plpgsql_array_interface_indexby" does not exist, skipping
create schema plpgsql_array_interface_indexby;
set current_schema = plpgsql_array_interface_indexby;
-- must be call in procedure --
select array_indexby_delete(array[1, 2]);
ERROR:  array_indexby_delete must be call in procedure
CONTEXT:  referenced column: array_indexby_delete
-- test array interface count --
create or replace procedure array_interface_p1() as
declare
    type ta is table of varchar(32) index by varchar;
    colors ta;  -- array['red', 'orange', null, '', 'green', 'blue', 'indigo', 'violet']
begin
    colors('a1234567') := 'red';
	colors('a12345678') := 'orange';
    colors('a2345671') := null;
    colors('a3456712') := '';
    colors('a4567123') := 'green';
    colors('a5671234') := 'blue';
    colors('a6712345') := 'indigo';
    colors('a7123456') := 'violet';
    raise NOTICE '%', colors;
    raise NOTICE '%', colors.count;
    colors[1] := null;
    colors[4] := null;
    colors[6] := '';
    raise NOTICE '%', colors;
    raise NOTICE '%', colors.count;
end;
/
call array_interface_p1();
NOTICE:  {red,orange,NULL,NULL,green,blue,indigo,violet}
NOTICE:  8
NOTICE:  {red,orange,NULL,NULL,green,blue,indigo,violet,NULL,NULL,NULL}
NOTICE:  11
 array_interface_p1 
--------------------
 
(1 row)

create or replace procedure array_interface_p1() as
declare
    type ta is table of varchar(32) index by integer;
    colors ta;  -- array['red', 'orange', null, '', 'green', 'blue', 'indigo', 'violet']
begin
    colors(5) := 'red';
    colors(-1) := 'orange';
    colors(2) := null;
    colors(8) := '';
    colors(-6) := 'green';
    colors(10) := 'blue';
    colors(-3) := 'indigo';
    colors(3) := 'violet';
    raise NOTICE '%', colors;
    raise NOTICE '%', colors.count;
    colors[1] := null;
    colors[4] := null;
    colors[6] := '';
    raise NOTICE '%', colors;
    raise NOTICE '%', colors.count;
end;
/
call array_interface_p1();
NOTICE:  {red,orange,NULL,NULL,green,blue,indigo,violet}
NOTICE:  8
NOTICE:  {red,orange,NULL,NULL,green,blue,indigo,violet,NULL,NULL,NULL}
NOTICE:  11
 array_interface_p1 
--------------------
 
(1 row)

-- test array interface exists --
create or replace procedure array_interface_p2() as
declare
    type ta is table of varchar(32) index by varchar;
    colors ta;  -- array[null,'red','orange',null,'green','','blue',null,'indigo','violet',null]
    ind varchar2(32);
begin
    colors('1') := null;
    colors('2') := 'red';
    colors('3') := 'orange';
    colors('4') := null;
    colors('5') := 'green';
    colors('6') := '';
    colors('7') := 'blue';
    colors('8') := null;
    colors('9') := 'indigo';
    colors('10') := 'violet';
    colors('11') := null;
    raise NOTICE '--------------------colors--------------------------';
    raise NOTICE '%', colors;
	ind := colors.first;
	raise NOTICE '%', ind;
    while colors.exists(ind) loop
        raise NOTICE '%:%', ind, colors(ind);
        ind := colors.next(ind);
    end loop;
end;
/
call array_interface_p2();
NOTICE:  --------------------colors--------------------------
NOTICE:  {NULL,red,orange,NULL,green,NULL,blue,NULL,indigo,violet,NULL}
NOTICE:  1
NOTICE:  1:<NULL>
NOTICE:  10:violet
NOTICE:  11:<NULL>
NOTICE:  2:red
NOTICE:  3:orange
NOTICE:  4:<NULL>
NOTICE:  5:green
NOTICE:  6:<NULL>
NOTICE:  7:blue
NOTICE:  8:<NULL>
NOTICE:  9:indigo
 array_interface_p2 
--------------------
 
(1 row)

-- test array interface exists --
create or replace procedure array_interface_p2() as
declare
    type ta is table of varchar(32) index by integer;
    colors ta;  -- array[null,'red','orange',null,'green','','blue',null,'indigo','violet',null]
    ind varchar2(32);
begin
    colors(5) := null;
    colors(-3) := 'orange';
    colors(-5) := null;
    colors(-1) := 'green';
    colors(0) := '';
    colors(3) := 'indigo';
    colors(1) := 'blue';
    colors(-2) := null;
    colors(2) := null;
    colors(-4) := 'red';
    colors(4) := 'violet';
    
    raise NOTICE '--------------------colors--------------------------';
    raise NOTICE '%', colors;
    ind := colors.first;
    raise NOTICE '%', ind;
    while colors.exists(ind) loop
        raise NOTICE '%:%', ind, colors(ind);
        ind := colors.next(ind);
    end loop;
end;
/
call array_interface_p2();
NOTICE:  --------------------colors--------------------------
NOTICE:  {NULL,orange,NULL,green,NULL,indigo,blue,NULL,NULL,red,violet}
NOTICE:  -5
NOTICE:  -5:<NULL>
NOTICE:  -4:red
NOTICE:  -3:orange
NOTICE:  -2:<NULL>
NOTICE:  -1:green
NOTICE:  0:<NULL>
NOTICE:  1:blue
NOTICE:  2:<NULL>
NOTICE:  3:indigo
NOTICE:  4:violet
NOTICE:  5:<NULL>
 array_interface_p2 
--------------------
 
(1 row)

-- test array interface exists --
create or replace procedure array_interface_p3() as
declare
    type ta is table of integer index by varchar;
    colors ta; -- array[1,2,'',3,4,null,5,6,7,8,9]
    ind varchar2(32);
begin
    colors('a') := 1;
    colors('ab') := 2;
    colors('ba') := '';
    colors('bab') := 3;
    colors('bb') := 4;
    colors('bc') := null;
    colors('ca') := 5;
    colors('cb') := 6;
    colors('cab') := 7;
    colors('cba') := 8;
    colors('cbb') := 9;
    raise NOTICE '--------------------colors--------------------------';
    raise NOTICE '%', colors;
	ind := colors.first;
	raise NOTICE '%', ind;
    while colors.exists(ind) loop
        raise NOTICE '%:%', ind, colors[ind];
        raise NOTICE '%', colors.exists(ind);
		ind := colors.next(ind);
    end loop;
end;
/
call array_interface_p3();
NOTICE:  --------------------colors--------------------------
NOTICE:  {1,2,NULL,3,4,NULL,5,6,7,8,9}
NOTICE:  a
NOTICE:  a:1
NOTICE:  t
NOTICE:  ab:2
NOTICE:  t
NOTICE:  ba:<NULL>
NOTICE:  t
NOTICE:  bab:3
NOTICE:  t
NOTICE:  bb:4
NOTICE:  t
NOTICE:  bc:<NULL>
NOTICE:  t
NOTICE:  ca:5
NOTICE:  t
NOTICE:  cab:7
NOTICE:  t
NOTICE:  cb:6
NOTICE:  t
NOTICE:  cba:8
NOTICE:  t
NOTICE:  cbb:9
NOTICE:  t
 array_interface_p3 
--------------------
 
(1 row)

-- test array interface first and last --
create or replace procedure array_interface_p4() as
declare
    type ta is table of varchar(32) index by varchar;
    type tb is table of integer index by varchar;
    colors1 ta; -- array['red','orange',null,'green','','blue']
    colors2 ta; -- array['red','orange',null,'green','blue',null]
    colors3 ta; -- array[null,'red','orange',null,'green','blue']
    colors4 tb; -- array[null,1,2,3,4,null,5,6,7,8,null,'']
begin
    colors1('123') := 'red';
    colors1('132') := 'orange';
    colors1('213') := null;
    colors1('231') := 'green';
    colors1('312') := '';
    colors1('321') := 'blue';
    raise NOTICE '---------colors1---------';
    raise NOTICE '%', colors1;
    raise NOTICE 'colors1 first number: %', colors1.first;
    raise NOTICE 'colors1 first: %', colors1[colors1.first];
    raise NOTICE 'colors1 last number: %', colors1.last;
    raise NOTICE 'colors1 last: %', colors1[colors1.last];

    colors2('abc') := 'red';
    colors2('acb') := 'orange';
    colors2('bac') := null;
    colors2('bca') := 'green';
    colors2('cab') := 'blue';
    colors2('cba') := null;
    raise NOTICE '---------colors2---------';
    raise NOTICE '%', colors2;
    raise NOTICE 'colors2 first number: %', colors2.first;
    raise NOTICE 'colors2 first: %', colors2[colors2.first];
    raise NOTICE 'colors2 last number: %', colors2.last;
    raise NOTICE 'colors2 last: %', colors2[colors2.last];

    colors3('a1') := null;
    colors3('a2') := 'red';
    colors3('b1') := 'orange';
    colors3('ba') := null;
    colors3('b2') := 'green';
    colors3('a0') := 'blue';
    raise NOTICE '---------colors3---------';
    raise NOTICE '%', colors3;
    raise NOTICE 'colors3 first number: %', colors3.first;
    raise NOTICE 'colors3 first: %', colors3[colors3.first];
    raise NOTICE 'colors3 last number: %', colors3.last;
    raise NOTICE 'colors3 last: %', colors3[colors3.last];

    colors4('a312') := null;
    colors4('a123') := 1;
    colors4('b1') := 2;
    colors4('ba') := 3;
    colors4('b0') := 4;
    colors4('a0') := null;
    colors4('b1') := 5;
    colors4('bc') := 6;
    colors4('bb') := 7;
    colors4('c1') := 8;
    colors4('ca') := null;
    colors4('cb') := '';
    raise NOTICE '---------colors4---------';
    raise NOTICE '%', colors4;
    raise NOTICE 'colors4 first number: %', colors4.first;
    raise NOTICE 'colors4 first: %', colors4[colors4.first];
    raise NOTICE 'colors4 last number: %', colors4.last;
    raise NOTICE 'colors4 last: %', colors4[colors4.last];
end;
/
call array_interface_p4();
NOTICE:  ---------colors1---------
NOTICE:  {red,orange,NULL,green,NULL,blue}
NOTICE:  colors1 first number: 123
NOTICE:  colors1 first: red
NOTICE:  colors1 last number: 321
NOTICE:  colors1 last: blue
NOTICE:  ---------colors2---------
NOTICE:  {red,orange,NULL,green,blue,NULL}
NOTICE:  colors2 first number: abc
NOTICE:  colors2 first: red
NOTICE:  colors2 last number: cba
NOTICE:  colors2 last: <NULL>
NOTICE:  ---------colors3---------
NOTICE:  {NULL,red,orange,NULL,green,blue}
NOTICE:  colors3 first number: a0
NOTICE:  colors3 first: blue
NOTICE:  colors3 last number: ba
NOTICE:  colors3 last: <NULL>
NOTICE:  ---------colors4---------
NOTICE:  {NULL,1,5,3,4,NULL,6,7,8,NULL,NULL}
NOTICE:  colors4 first number: a0
NOTICE:  colors4 first: <NULL>
NOTICE:  colors4 last number: cb
NOTICE:  colors4 last: <NULL>
 array_interface_p4 
--------------------
 
(1 row)

-- test array interface first and last --
create or replace procedure array_interface_p4() as
declare
    type ta is table of varchar(32) index by integer;
    colors1 ta; -- array['red','orange',null,'green','','blue']
begin
    colors1(132) := 'orange';
    colors1(321) := 'blue';
    colors1(213) := null;
    colors1(123) := 'red';
    colors1(231) := 'green';
    colors1(312) := '';
    
    raise NOTICE '---------colors1---------';
    raise NOTICE '%', colors1;
    raise NOTICE 'colors1 first number: %', colors1.first;
    raise NOTICE 'colors1 first: %', colors1[colors1.first];
    raise NOTICE 'colors1 last number: %', colors1.last;
    raise NOTICE 'colors1 last: %', colors1[colors1.last];
end;
/
call array_interface_p4();
NOTICE:  ---------colors1---------
NOTICE:  {orange,blue,NULL,red,green,NULL}
NOTICE:  colors1 first number: 123
NOTICE:  colors1 first: red
NOTICE:  colors1 last number: 321
NOTICE:  colors1 last: blue
 array_interface_p4 
--------------------
 
(1 row)

-- next&prior
create or replace procedure array_interface_p5() as
declare
    type ta is table of varchar(32) index by varchar;
    type tb is table of integer index by varchar;
    colors1 ta; -- array['red','orange',null,'green','blue','','indigo','violet']
    colors2 tb; -- array[1,2,3,null,4,5,6,'',7,8]
	ind varchar2(32);
	tmp varchar2(32);
begin
    colors1('1') := 'red';
    colors1('2') := 'orange';
    colors1('3') := null;
    colors1('4') := 'green';
    colors1('5') := 'blue';
    colors1('6') := '';
    colors1('7') := 'indigo';
    colors1('8') := 'violet';
    raise NOTICE '--------------------colors1---------------------';
    raise NOTICE '%', colors1;
	ind := colors1.first;
    while colors1.exists(ind) loop
        raise NOTICE 'current is: %', colors1[ind];
        raise NOTICE 'next index is: %', colors1.next(ind);
		tmp := colors1.next(ind);
		if tmp is null then
        raise NOTICE 'next element is: %', tmp;
		else
		raise NOTICE 'next element is: %', colors1[tmp];
		end if;
        raise NOTICE 'prior index is: %', colors1.prior(ind);
		tmp := colors1.prior(ind);
		if tmp is null then
        raise NOTICE 'prior element is: %', tmp;
		else
		raise NOTICE 'prior element is: %', colors1[tmp];
		end if;
        raise NOTICE '-------slash-------';
		ind := colors1.next(ind);
    end loop;

    colors1('a') := 1;
    colors1('b') := 2;
    colors1('c') := 3;
    colors1('d') := null;
    colors1('e') := 4;
    colors1('f') := 5;
    colors1('g') := 6;
    colors1('h') := '';
    colors1('i') := 7;
    colors1('j') := 8;
    raise NOTICE '--------------------colors2---------------------';
    raise NOTICE '%', colors2;
    ind := colors1.first;
    while colors1.exists(ind) loop
        raise NOTICE 'current is: %', colors2[ind];
        raise NOTICE 'next index is: %', colors2.next(ind);
        raise NOTICE 'next element is: %', colors2[colors2.next(ind)];
        raise NOTICE 'prior index is: %', colors2.prior(ind);
        raise NOTICE 'prior element is: %', colors2[colors2.prior(ind)];
        raise NOTICE '-----------';
		ind := colors1.next(ind);
    end loop;
end;
/
call array_interface_p5();
NOTICE:  --------------------colors1---------------------
NOTICE:  {red,orange,NULL,green,blue,NULL,indigo,violet}
NOTICE:  current is: red
NOTICE:  next index is: 2
NOTICE:  next element is: orange
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -------slash-------
NOTICE:  current is: orange
NOTICE:  next index is: 3
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: 1
NOTICE:  prior element is: red
NOTICE:  -------slash-------
NOTICE:  current is: <NULL>
NOTICE:  next index is: 4
NOTICE:  next element is: green
NOTICE:  prior index is: 2
NOTICE:  prior element is: orange
NOTICE:  -------slash-------
NOTICE:  current is: green
NOTICE:  next index is: 5
NOTICE:  next element is: blue
NOTICE:  prior index is: 3
NOTICE:  prior element is: <NULL>
NOTICE:  -------slash-------
NOTICE:  current is: blue
NOTICE:  next index is: 6
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: 4
NOTICE:  prior element is: green
NOTICE:  -------slash-------
NOTICE:  current is: <NULL>
NOTICE:  next index is: 7
NOTICE:  next element is: indigo
NOTICE:  prior index is: 5
NOTICE:  prior element is: blue
NOTICE:  -------slash-------
NOTICE:  current is: indigo
NOTICE:  next index is: 8
NOTICE:  next element is: violet
NOTICE:  prior index is: 6
NOTICE:  prior element is: <NULL>
NOTICE:  -------slash-------
NOTICE:  current is: violet
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: 7
NOTICE:  prior element is: indigo
NOTICE:  -------slash-------
NOTICE:  --------------------colors2---------------------
NOTICE:  <NULL>
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
NOTICE:  current is: <NULL>
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -----------
 array_interface_p5 
--------------------
 
(1 row)

create or replace procedure array_interface_p5() as
declare
    type ta is table of varchar(32) index by integer;
    colors1 ta; -- array['red','orange',null,'green','blue','','indigo','violet']
    ind varchar2(32);
    tmp varchar2(32);
begin
    colors1(-15) := 'red';
    colors1(-8) := 'orange';
    colors1(-1) := null;
    colors1(0) := 'green';
    colors1(10) := 'blue';
    colors1(24) := '';
    colors1(45) := 'indigo';
    colors1(50) := 'violet';
    raise NOTICE '--------------------colors1---------------------';
    raise NOTICE '%', colors1;
    ind := colors1.first;
    while colors1.exists(ind) loop
        raise NOTICE 'current is: %', colors1[ind];
        raise NOTICE 'next index is: %', colors1.next(ind);
        tmp := colors1.next(ind);
        if tmp is null then
        raise NOTICE 'next element is: %', tmp;
        else
        raise NOTICE 'next element is: %', colors1[tmp];
        end if;
        raise NOTICE 'prior index is: %', colors1.prior(ind);
        tmp := colors1.prior(ind);
        if tmp is null then
        raise NOTICE 'prior element is: %', tmp;
        else
        raise NOTICE 'prior element is: %', colors1[tmp];
        end if;
        raise NOTICE '-------slash-------';
        ind := colors1.next(ind);
    end loop;
end;
/
call array_interface_p5();
NOTICE:  --------------------colors1---------------------
NOTICE:  {red,orange,NULL,green,blue,NULL,indigo,violet}
NOTICE:  current is: red
NOTICE:  next index is: -8
NOTICE:  next element is: orange
NOTICE:  prior index is: <NULL>
NOTICE:  prior element is: <NULL>
NOTICE:  -------slash-------
NOTICE:  current is: orange
NOTICE:  next index is: -1
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: -15
NOTICE:  prior element is: red
NOTICE:  -------slash-------
NOTICE:  current is: <NULL>
NOTICE:  next index is: 0
NOTICE:  next element is: green
NOTICE:  prior index is: -8
NOTICE:  prior element is: orange
NOTICE:  -------slash-------
NOTICE:  current is: green
NOTICE:  next index is: 10
NOTICE:  next element is: blue
NOTICE:  prior index is: -1
NOTICE:  prior element is: <NULL>
NOTICE:  -------slash-------
NOTICE:  current is: blue
NOTICE:  next index is: 24
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: 0
NOTICE:  prior element is: green
NOTICE:  -------slash-------
NOTICE:  current is: <NULL>
NOTICE:  next index is: 45
NOTICE:  next element is: indigo
NOTICE:  prior index is: 10
NOTICE:  prior element is: blue
NOTICE:  -------slash-------
NOTICE:  current is: indigo
NOTICE:  next index is: 50
NOTICE:  next element is: violet
NOTICE:  prior index is: 24
NOTICE:  prior element is: <NULL>
NOTICE:  -------slash-------
NOTICE:  current is: violet
NOTICE:  next index is: <NULL>
NOTICE:  next element is: <NULL>
NOTICE:  prior index is: 45
NOTICE:  prior element is: indigo
NOTICE:  -------slash-------
 array_interface_p5 
--------------------
 
(1 row)

-- test empty array exists interface return
create or replace procedure array_interface_p6() as
declare
    type ta is table of varchar(32) index by varchar;
    type tb is table of integer index by varchar;
    colors1 ta := array[]::varchar[];
    colors2 tb := array[]::integer[];
    vi varchar2(32);
begin
    raise NOTICE 'colors1 is %', colors1;
    raise NOTICE 'colors1 length is %', colors1.count;
    raise NOTICE 'colors1 first is %', colors1.first;
    raise NOTICE 'colors1 last is %', colors1.last;
    raise NOTICE 'colors2 is %', colors2;
    raise NOTICE 'colors2 length is %', colors2.count;
    raise NOTICE 'colors2 first is %', colors2.first;
    raise NOTICE 'colors2 last is %', colors2.last;
    vi := 111;
    raise NOTICE 'colors1[%] exists return %', vi, colors1.exists(vi);
    vi := '1';
    raise NOTICE 'colors1["%"] exists return %', vi, colors1.exists(vi);
    vi := 123432;
    raise NOTICE 'colors2[%] exists return %', vi, colors2.exists(vi);
    vi := '43243442';
    raise NOTICE 'colors2["%"] exists return %', vi, colors2.exists(vi);
end;
/
call array_interface_p6();
NOTICE:  colors1 is {}
NOTICE:  colors1 length is 0
NOTICE:  colors1 first is <NULL>
NOTICE:  colors1 last is <NULL>
NOTICE:  colors2 is {}
NOTICE:  colors2 length is 0
NOTICE:  colors2 first is <NULL>
NOTICE:  colors2 last is <NULL>
NOTICE:  colors1[111] exists return f
NOTICE:  colors1["1"] exists return f
NOTICE:  colors2[123432] exists return f
NOTICE:  colors2["43243442"] exists return f
 array_interface_p6 
--------------------
 
(1 row)

-- test empty array exists interface return
create or replace procedure array_interface_p6() as
declare
    type ta is table of varchar(32) index by integer;
    type tb is table of integer index by integer;
    colors1 ta := array[]::varchar[];
    colors2 tb := array[]::integer[];
    vi varchar2(32);
begin
    raise NOTICE 'colors1 is %', colors1;
    raise NOTICE 'colors1 length is %', colors1.count;
    raise NOTICE 'colors1 first is %', colors1.first;
    raise NOTICE 'colors1 last is %', colors1.last;
    raise NOTICE 'colors2 is %', colors2;
    raise NOTICE 'colors2 length is %', colors2.count;
    raise NOTICE 'colors2 first is %', colors2.first;
    raise NOTICE 'colors2 last is %', colors2.last;
    vi := 111;
    raise NOTICE 'colors1[%] exists return %', vi, colors1.exists(vi);
    vi := '1';
    raise NOTICE 'colors1["%"] exists return %', vi, colors1.exists(vi);
    vi := 123432;
    raise NOTICE 'colors2[%] exists return %', vi, colors2.exists(vi);
    vi := '43243442';
    raise NOTICE 'colors2["%"] exists return %', vi, colors2.exists(vi);
end;
/
call array_interface_p6();
NOTICE:  colors1 is {}
NOTICE:  colors1 length is 0
NOTICE:  colors1 first is <NULL>
NOTICE:  colors1 last is <NULL>
NOTICE:  colors2 is {}
NOTICE:  colors2 length is 0
NOTICE:  colors2 first is <NULL>
NOTICE:  colors2 last is <NULL>
NOTICE:  colors1[111] exists return f
NOTICE:  colors1["1"] exists return f
NOTICE:  colors2[123432] exists return f
NOTICE:  colors2["43243442"] exists return f
 array_interface_p6 
--------------------
 
(1 row)

-- test array exists interface A.B input parameter
create or replace procedure array_interface_p7() as
declare
    type ta is table of varchar(32) index by varchar;
    v_a  ta := array[]::varchar2[];
begin
    raise NOTICE 'v_a is %', v_a;
    for rec in (select generate_series(1,10) x) loop
        if v_a.exists(rec.x) then
            raise NOTICE 'v_a[%] is exist', rec.x;
        else
            raise NOTICE 'v_a[%] is not exist', rec.x;
        end if;
    end loop;
    for i in 1 .. 10 loop
        v_a(i) := i;
    end loop;
    raise NOTICE 'v_a is %', v_a;
    for rec in (select generate_series(1,10) x) loop
        if v_a.exists(rec.x) then
            raise NOTICE 'v_a[%] is exist', rec.x;
        else
            raise NOTICE 'v_a[%] is not exist', rec.x;
        end if;
    end loop;
end;
/
call array_interface_p7();
NOTICE:  v_a is {}
NOTICE:  v_a[1] is not exist
NOTICE:  v_a[2] is not exist
NOTICE:  v_a[3] is not exist
NOTICE:  v_a[4] is not exist
NOTICE:  v_a[5] is not exist
NOTICE:  v_a[6] is not exist
NOTICE:  v_a[7] is not exist
NOTICE:  v_a[8] is not exist
NOTICE:  v_a[9] is not exist
NOTICE:  v_a[10] is not exist
NOTICE:  v_a is {1,2,3,4,5,6,7,8,9,10}
NOTICE:  v_a[1] is exist
NOTICE:  v_a[2] is exist
NOTICE:  v_a[3] is exist
NOTICE:  v_a[4] is exist
NOTICE:  v_a[5] is exist
NOTICE:  v_a[6] is exist
NOTICE:  v_a[7] is exist
NOTICE:  v_a[8] is exist
NOTICE:  v_a[9] is exist
NOTICE:  v_a[10] is exist
 array_interface_p7 
--------------------
 
(1 row)

-- test array exists interface A.B input parameter
create or replace procedure array_interface_p7() as
declare
    type ta is table of varchar(32) index by integer;
    v_a  ta := array[]::varchar2[];
begin
    raise NOTICE 'v_a is %', v_a;
    for rec in (select generate_series(1,10) x) loop
        if v_a.exists(rec.x) then
            raise NOTICE 'v_a[%] is exist', rec.x;
        else
            raise NOTICE 'v_a[%] is not exist', rec.x;
        end if;
    end loop;
    for i in 1 .. 10 loop
        v_a(i) := i;
    end loop;
    raise NOTICE 'v_a is %', v_a;
    for rec in (select generate_series(1,10) x) loop
        if v_a.exists(rec.x) then
            raise NOTICE 'v_a[%] is exist', rec.x;
        else
            raise NOTICE 'v_a[%] is not exist', rec.x;
        end if;
    end loop;
end;
/
call array_interface_p7();
NOTICE:  v_a is {}
NOTICE:  v_a[1] is not exist
NOTICE:  v_a[2] is not exist
NOTICE:  v_a[3] is not exist
NOTICE:  v_a[4] is not exist
NOTICE:  v_a[5] is not exist
NOTICE:  v_a[6] is not exist
NOTICE:  v_a[7] is not exist
NOTICE:  v_a[8] is not exist
NOTICE:  v_a[9] is not exist
NOTICE:  v_a[10] is not exist
NOTICE:  v_a is {1,2,3,4,5,6,7,8,9,10}
NOTICE:  v_a[1] is exist
NOTICE:  v_a[2] is exist
NOTICE:  v_a[3] is exist
NOTICE:  v_a[4] is exist
NOTICE:  v_a[5] is exist
NOTICE:  v_a[6] is exist
NOTICE:  v_a[7] is exist
NOTICE:  v_a[8] is exist
NOTICE:  v_a[9] is exist
NOTICE:  v_a[10] is exist
 array_interface_p7 
--------------------
 
(1 row)

create or replace procedure array_interface_p8() as
declare
    type ta is table of varchar(32) index by varchar;
    colors ta;
begin
    -- colors := array['red','orange','yellow','green','blue','indigo','violet','c8','c9','c10','c11','c12','c13','c14','c15'];
    colors('0') := 'red';
    colors('1') := 'orange';
    colors('2') := 'yellow';
    colors('3') := 'green';
    colors('4') := 'blue';
    colors('5') := 'indigo';
    colors('6') := 'violet';
    colors('7') := 'c8';
    colors('8') := 'c9';
    colors('9') := 'c10';
    colors('10') := 'c11';
    colors('11') := 'c12';
    colors('12') := 'c13';
    colors('13') := 'c14';
    colors('14') := 'c15';
    if colors.exists(1+1) then
        raise NOTICE 'array exist, element is %', colors[1+1];
    else
        raise NOTICE 'array not exist';
    end if;
	if colors.exists('1' || '2') then
        raise NOTICE 'array exist, element is %', colors['1'||'2'];
    else
        raise NOTICE 'array not exist';
    end if;
end;
/
call array_interface_p8();
NOTICE:  array exist, element is yellow
NOTICE:  array exist, element is c13
 array_interface_p8 
--------------------
 
(1 row)

create or replace procedure array_interface_p8() as
declare
    type ta is table of varchar(32) index by integer;
    colors ta;
begin
    -- colors := array['red','orange','yellow','green','blue','indigo','violet','c8','c9','c10','c11','c12','c13','c14','c15'];
    colors(0) := 'red';
    colors(1) := 'orange';
    colors(2) := 'yellow';
    colors(3) := 'green';
    colors(4) := 'blue';
    colors(5) := 'indigo';
    colors(6) := 'violet';
    colors(7) := 'c8';
    colors(8) := 'c9';
    colors(9) := 'c10';
    colors(10) := 'c11';
    colors(11) := 'c12';
    colors(12) := 'c13';
    colors(13) := 'c14';
    colors(14) := 'c15';
    if colors.exists(1+1) then
        raise NOTICE 'array exist, element is %', colors[1+1];
    else
        raise NOTICE 'array not exist';
    end if;
    if colors.exists('1' || '2') then
        raise NOTICE 'array exist, element is %', colors['1'||'2'];
    else
        raise NOTICE 'array not exist';
    end if;
end;
/
call array_interface_p8();
NOTICE:  array exist, element is yellow
NOTICE:  array exist, element is c13
 array_interface_p8 
--------------------
 
(1 row)

create or replace procedure array_interface_p9() as
declare
    type ta is table of varchar(32) index by varchar;
    colors ta;
begin
    -- colors := array['red','orange','yellow','green','blue','indigo','violet'];
    colors('1') := 'red';
    colors('2') := 'orange';
    colors('3') := 'yellow';
    colors('4') := 'green';
    colors('5') := 'blue';
    colors('6') := 'indigo';
    colors('7') := 'violet';
    raise NOTICE '%', colors;
    raise NOTICE '%', colors.count;
    raise NOTICE '%', colors.count();
    raise NOTICE '%', colors.first;
    raise NOTICE '%', colors.first();
    raise NOTICE '%', colors.last;
    raise NOTICE '%', colors.last();
    for i in colors.first .. colors.last loop
        raise NOTICE '%', colors[i];
    end loop;
    for i in 1 .. colors.count loop
        raise NOTICE '%', colors[i];
    end loop;
    for i in colors.first() .. colors.last() loop
        raise NOTICE '%', colors[i];
    end loop;
    for i in 1 .. colors.count() loop
        raise NOTICE '%', colors[i];
    end loop;
    colors.delete('7');
    raise NOTICE '%', colors;
    colors.delete('1');
    raise NOTICE '%', colors;
	colors.delete('13424');
    raise NOTICE '%', colors;
    colors.delete();
    raise NOTICE '%', colors;
	raise NOTICE '%', colors.count;
	raise NOTICE '%', colors.first;
	raise NOTICE '%', colors.last;
	raise NOTICE '%', colors.next('1');
	raise NOTICE '%', colors.prior('1');
	raise NOTICE '%', colors;
	colors.delete('1');
    raise NOTICE '%', colors;
end;
/
call array_interface_p9();
NOTICE:  {red,orange,yellow,green,blue,indigo,violet}
NOTICE:  7
NOTICE:  7
NOTICE:  1
NOTICE:  1
NOTICE:  7
NOTICE:  7
NOTICE:  red
NOTICE:  orange
NOTICE:  yellow
NOTICE:  green
NOTICE:  blue
NOTICE:  indigo
NOTICE:  violet
NOTICE:  red
NOTICE:  orange
NOTICE:  yellow
NOTICE:  green
NOTICE:  blue
NOTICE:  indigo
NOTICE:  violet
NOTICE:  red
NOTICE:  orange
NOTICE:  yellow
NOTICE:  green
NOTICE:  blue
NOTICE:  indigo
NOTICE:  violet
NOTICE:  red
NOTICE:  orange
NOTICE:  yellow
NOTICE:  green
NOTICE:  blue
NOTICE:  indigo
NOTICE:  violet
NOTICE:  {red,orange,yellow,green,blue,indigo}
NOTICE:  {orange,yellow,green,blue,indigo}
NOTICE:  {orange,yellow,green,blue,indigo}
NOTICE:  {}
NOTICE:  0
NOTICE:  <NULL>
NOTICE:  <NULL>
NOTICE:  <NULL>
NOTICE:  <NULL>
NOTICE:  {}
NOTICE:  {}
 array_interface_p9 
--------------------
 
(1 row)

create or replace procedure array_interface_p9() as
declare
    type ta is table of varchar(32) index by integer;
    colors ta;
begin
    -- colors := array['red','orange','yellow','green','blue','indigo','violet'];
    colors(1) := 'red';
    colors(2) := 'orange';
    colors(3) := 'yellow';
    colors(4) := 'green';
    colors(5) := 'blue';
    colors(6) := 'indigo';
    colors(7) := 'violet';
    raise NOTICE '%', colors;
    raise NOTICE '%', colors.count;
    raise NOTICE '%', colors.count();
    raise NOTICE '%', colors.first;
    raise NOTICE '%', colors.first();
    raise NOTICE '%', colors.last;
    raise NOTICE '%', colors.last();
    for i in colors.first .. colors.last loop
        raise NOTICE '%', colors[i];
    end loop;
    for i in 1 .. colors.count loop
        raise NOTICE '%', colors[i];
    end loop;
    for i in colors.first() .. colors.last() loop
        raise NOTICE '%', colors[i];
    end loop;
    for i in 1 .. colors.count() loop
        raise NOTICE '%', colors[i];
    end loop;
    colors.delete(7);
    raise NOTICE '%', colors;
    colors.delete(1);
    raise NOTICE '%', colors;
    colors.delete(13424);
    raise NOTICE '%', colors;
    colors.delete();
    raise NOTICE '%', colors;
    raise NOTICE '%', colors.count;
    raise NOTICE '%', colors.first;
    raise NOTICE '%', colors.last;
    raise NOTICE '%', colors.next(1);
    raise NOTICE '%', colors.prior(1);
    raise NOTICE '%', colors;
    colors.delete(1);
    raise NOTICE '%', colors;
end;
/
call array_interface_p9();
NOTICE:  {red,orange,yellow,green,blue,indigo,violet}
NOTICE:  7
NOTICE:  7
NOTICE:  1
NOTICE:  1
NOTICE:  7
NOTICE:  7
NOTICE:  red
NOTICE:  orange
NOTICE:  yellow
NOTICE:  green
NOTICE:  blue
NOTICE:  indigo
NOTICE:  violet
NOTICE:  red
NOTICE:  orange
NOTICE:  yellow
NOTICE:  green
NOTICE:  blue
NOTICE:  indigo
NOTICE:  violet
NOTICE:  red
NOTICE:  orange
NOTICE:  yellow
NOTICE:  green
NOTICE:  blue
NOTICE:  indigo
NOTICE:  violet
NOTICE:  red
NOTICE:  orange
NOTICE:  yellow
NOTICE:  green
NOTICE:  blue
NOTICE:  indigo
NOTICE:  violet
NOTICE:  {red,orange,yellow,green,blue,indigo}
NOTICE:  {orange,yellow,green,blue,indigo}
NOTICE:  {orange,yellow,green,blue,indigo}
NOTICE:  {}
NOTICE:  0
NOTICE:  <NULL>
NOTICE:  <NULL>
NOTICE:  <NULL>
NOTICE:  <NULL>
NOTICE:  {}
NOTICE:  {}
 array_interface_p9 
--------------------
 
(1 row)

declare
type ta is table of varchar2(10) index by varchar2;
va ta;
var varchar(10);
begin
va('a1') = 'a';
va('a2') = 'b';
va('a3') = 'c';
va('aaa') = 'd';
var = 'a';
raise notice '%' , va.exists('a'||'2');
raise notice '%' , va.exists('a'||'4');
if va.exists('a'|| var ||'a') then
raise NOTICE 'aaa exists';
else
raise NOTICE 'not exists';
end if;
raise notice '%' , va.next('a'||'2');
raise notice '%' , va.prior('a'||'2');
raise notice '%' , va(va.prior('a'||'2'));
raise notice '%' , va(va.first());
raise notice '%' , va(va.last());
end;
/
NOTICE:  t
NOTICE:  f
NOTICE:  aaa exists
NOTICE:  a3
NOTICE:  a1
NOTICE:  a
NOTICE:  a
NOTICE:  d
declare
type ta is table of varchar2(10) index by integer;
va ta;
var varchar(10);
begin
va(11) = 'a';
va(12) = 'b';
va(13) = 'c';
va('111') = 'd';
var = '1';
raise notice '%' , va.exists('1'||'2');
raise notice '%' , va.exists('1'||'4');
if va.exists('1'|| var ||'1') then
raise NOTICE '111 exists';
else
raise NOTICE 'not exists';
end if;
raise notice '%' , va.next('1'||'2');
raise notice '%' , va.prior('1'||'2');
raise notice '%' , va(va.prior('1'||'2'));
raise notice '%' , va(va.first());
raise notice '%' , va(va.last());
end;
/
NOTICE:  t
NOTICE:  f
NOTICE:  111 exists
NOTICE:  13
NOTICE:  11
NOTICE:  a
NOTICE:  a
NOTICE:  d
declare 
   type t_arr is table of number index by varchar2(20);
   v_arr t_arr;
begin
   if v_arr.exists('1'||'12')=false then
      raise info 'not exists';
   end if;
end;
/
INFO:  not exists
declare 
   type t_arr is table of number index by integer;
   v_arr t_arr;
begin
   if v_arr.exists(12)=false then
      raise info 'not exists';
   end if;
end;
/
INFO:  not exists
declare 
   type t_arr is varray(10) of number;
   v_arr t_arr;
begin
   if v_arr.exists(12)=false then
      raise info 'not exists';
   end if;
end;
/
INFO:  not exists
create or replace procedure indexbychar1()
as
type ta is table of varchar2(10) index by varchar2;
va ta;
var varchar(10);
begin
va('a1') = 'a';
va('a2') = 'b';
va('a3') = 'c';
va('aaa') = 'd';
var = 'a';
raise notice '%' , va.exists('a'||'2');
raise notice '%' , va.exists('a'||'4');
if va.exists('a'|| var ||'a') then
raise NOTICE 'aaa exists';
else
raise NOTICE 'not exists';
end if;
raise notice '%' , va.next('a'||'2');
raise notice '%' , va.prior('a'||'2');
raise notice '%' , va(va.prior('a'||'2'));
raise notice '%' , va(va.first());
raise notice '%' , va(va.last());
raise notice '%' , va.count;
va.delete();
raise notice '%' , va.count;
raise notice '%' , va(va.last());
exception when others then
raise notice 'delete all the array items';
for i in 1..10 loop
va(i) := 'va'||(i::varchar(2));
END LOOP;
raise notice '%', va.COUNT;
raise notice '%', va(1);
raise notice '%', va(10);
raise notice 'first%', va.FIRST;
raise notice 'last%', va.LAST;
raise notice '%', va;
raise notice '%', va(va.LAST);
raise notice '%', va(va.NEXT(va.FIRST));
raise notice '%', va(va.PRIOR(va.LAST));
end;
/
call indexbychar1();
NOTICE:  t
NOTICE:  f
NOTICE:  aaa exists
NOTICE:  a3
NOTICE:  a1
NOTICE:  a
NOTICE:  a
NOTICE:  d
NOTICE:  4
NOTICE:  0
NOTICE:  delete all the array items
NOTICE:  10
NOTICE:  va1
NOTICE:  va10
NOTICE:  first1
NOTICE:  last9
NOTICE:  {va1,va2,va3,va4,va5,va6,va7,va8,va9,va10}
NOTICE:  va9
NOTICE:  va10
NOTICE:  va8
 indexbychar1 
--------------
 
(1 row)

create table pkgtbl085 (c1 int,c2 number,c3 varchar2(30),c4 clob,c5 text,c6 blob);
insert into pkgtbl085 values(1,1,'var1','clob1','text1','bb1');
insert into pkgtbl085 values(2,2,'var2','clob2','text2','bb2');
insert into pkgtbl085 values(3,3,'var3','clob3','text3','bb3');
--I2.table of index by varchar2(20)
create or replace package pkg085
as
type ty1 is table of varchar2(20) index by varchar2(20);
type ty2 is record (c1 number,c2 pkgtbl085%rowtype);
procedure p1();
end pkg085;
/
create or replace package body pkg085
as
procedure p1()
is
va ty2;
vb ty1;
numcount int;
begin
for i in 1..3 loop
select c3 into va.c2.c3 from pkgtbl085 where c1=i;
if va.c2.c3 is not null then
vb(va.c2.c3)=va.c2.c3;
end if;
end loop;
raise info 'vb is %',vb;
raise info 'vb.count is %',vb.count;
raise info 'vb(va.c2,c3) is %',vb(va.c2.c3);
raise info 'va.c2.c3 is %',va.c2.c3;
raise info 'vb.prior(va.c2.c3) is %',vb.prior(va.c2.c3);
raise info 'vb.prior(var3) is %',vb.prior('var3');
va.c2.c3='var1';
raise info 'vb.next(va.c2.c3) is %',vb.next(va.c2.c3);
raise info 'vb.exists(va.c2.c3) is %',vb.exists(va.c2.c3);
if vb.exists(va.c2.c3) then
raise notice 'true';
end if;
end;
end pkg085;
/
call pkg085.p1();
INFO:  vb is {var1,var2,var3}
INFO:  vb.count is 3
INFO:  vb(va.c2,c3) is var3
INFO:  va.c2.c3 is var3
INFO:  vb.prior(va.c2.c3) is var2
INFO:  vb.prior(var3) is var2
INFO:  vb.next(va.c2.c3) is var2
INFO:  vb.exists(va.c2.c3) is t
NOTICE:  true
 p1 
----
 
(1 row)

drop package pkg085;
NOTICE:  drop cascades to function plpgsql_array_interface_indexby.p1()
drop table pkgtbl085;
create or replace procedure array_interface_p10() as
declare
    type ta is table of varchar(32) index by varchar;
    c1 ta;
    c2 ta;
begin
    if c1.first = c2.first then
	null;
	end if;
end;
/
ERROR:  do not support more than 2 table of index by variables call functions in an expr at or near "c2"
LINE 7:     if c1.first = c2.first then
                          ^
QUERY:  
declare
    type ta is table of varchar(32) index by varchar;
    c1 ta;
    c2 ta;
begin
    if c1.first = c2.first then
	null;
	end if;
end
create or replace procedure array_interface_p10() as
declare
    type ta is table of varchar(32) index by varchar;
    c1 ta;
    c2 ta;
begin
    raise info '%', c1.next(c2.first);
end;
/
ERROR:  do not support more than 2 table of index by variables call functions in an expr at or near "c2"
LINE 7:     raise info '%', c1.next(c2.first);
                                    ^
QUERY:  
declare
    type ta is table of varchar(32) index by varchar;
    c1 ta;
    c2 ta;
begin
    raise info '%', c1.next(c2.first);
end
create or replace procedure tableof_delete_1()
is
type ty4 is table of integer index by varchar;
pv4 ty4;
begin
pv4('1'):=2;
pv4('-1'):=-1;
pv4.delete('-1');
raise info '%', pv4('1');
raise info '%', pv4('-1');
raise info '%', pv4;
end;
/
call tableof_delete_1();
INFO:  2
INFO:  <NULL>
INFO:  {2}
 tableof_delete_1 
------------------
 
(1 row)

create or replace procedure tableof_delete_2()
is
type ty4 is table of integer index by integer;
pv4 ty4;
begin
pv4(1):=2;
pv4(-1):=-1;
pv4.delete(-1);
raise info '%', pv4(1);
raise info '%', pv4(-1);
raise info '%', pv4;
end;
/
call tableof_delete_2();
INFO:  2
INFO:  <NULL>
INFO:  {2}
 tableof_delete_2 
------------------
 
(1 row)

create or replace procedure tableof_delete_3()
is
type ty4 is varray(10) of integer;
pv4 ty4;
begin
pv4(1):=2;
pv4(-1):=-1;
pv4(-2):=-2;
raise info '%', pv4;
pv4.delete(-1);
raise info '%', pv4(1);
raise info '%', pv4(-1);
raise info '%', pv4;
end;
/
call tableof_delete_3();
INFO:  [-2:1]={-2,-1,NULL,2}
INFO:  <NULL>
INFO:  <NULL>
INFO:  [-2:0]={-2,NULL,2}
 tableof_delete_3 
------------------
 
(1 row)

create or replace procedure tableof_delete_4()
is
type ty4 is varray(10) of integer;
pv4 ty4;
begin
pv4(4):=2;
pv4(3):=-1;
pv4(2):=-2;
raise info '%', pv4;
pv4.delete(3);
raise info '%', pv4(4);
raise info '%', pv4;
end;
/
call tableof_delete_4();
INFO:  [2:4]={-2,-1,2}
INFO:  <NULL>
INFO:  [2:3]={-2,2}
 tableof_delete_4 
------------------
 
(1 row)

create or replace procedure tableof_delete_5()
is
type ty4 is varray(10) of integer;
pv4 ty4;
a integer;
begin
a = 1;
pv4(1):=2;
pv4(-1):=-1;
pv4(-2):=-2;
raise info '%', pv4;
pv4.delete(-a);
raise info '%', pv4(1);
raise info '%', pv4(-1);
raise info '%', pv4;
end;
/
call tableof_delete_5();
INFO:  [-2:1]={-2,-1,NULL,2}
INFO:  <NULL>
INFO:  <NULL>
INFO:  [-2:0]={-2,NULL,2}
 tableof_delete_5 
------------------
 
(1 row)

-- clean up --
drop schema if exists plpgsql_array_interface_indexby cascade;
NOTICE:  drop cascades to 15 other objects
DETAIL:  drop cascades to function array_interface_p1()
drop cascades to function array_interface_p2()
drop cascades to function array_interface_p3()
drop cascades to function array_interface_p4()
drop cascades to function array_interface_p5()
drop cascades to function array_interface_p6()
drop cascades to function array_interface_p7()
drop cascades to function array_interface_p8()
drop cascades to function array_interface_p9()
drop cascades to function indexbychar1()
drop cascades to function tableof_delete_1()
drop cascades to function tableof_delete_2()
drop cascades to function tableof_delete_3()
drop cascades to function tableof_delete_4()
drop cascades to function tableof_delete_5()
