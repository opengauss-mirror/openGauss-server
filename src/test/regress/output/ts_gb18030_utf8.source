create database gb18030_2022 encoding='gb18030-2022' LC_COLLATE='zh_CN.GB18030' LC_CTYPE ='zh_CN.GB18030' TEMPLATE=template0;
\c gb18030_2022
 
show server_encoding;
 server_encoding 
-----------------
 GB18030_2022
(1 row)

set client_encoding = 'UTF8';
show client_encoding;
 client_encoding 
-----------------
 UTF8
(1 row)

--1. ÁºñÁ†ÅÊò†Â∞ÑÂÖ≥Á≥ªÂèëÁîüÊîπÂèòÁöÑÂ≠óÁ¨¶Ôºö
-- Êü•ÁúãÊú™ÂèëÁîüÂèòÂåñÁöÑÂ≠óÁ¨¶‰∏≤Ôºö
select convert_to('‰∏≠ÂõΩ', 'GB18030-2022');
 convert_to 
------------
 \xd6d0b9fa
(1 row)

 
--ÊèíÂÖ•‰∫ÜÊ∂âÂèäGB18030-2000ÂçáÁ∫ßGB18030-2022ÂêéGB18030‰∏éUTF-8ËΩ¨Êç¢ÂÖ≥Á≥ªÂèòÊõ¥ÁöÑ19‰∏™Â≠óÁ¨¶„ÄÇ
create table tb_test(id int, content text);
 
insert into tb_test (id , content)
select 1, convert_from('\xA8BC', 'GB18030-2022');
 
insert into tb_test (id , content)
select 2, convert_from('\xA6D9', 'GB18030-2022');
 
insert into tb_test (id , content)
select 3, convert_from('\xA6DA', 'GB18030-2022');
 
insert into tb_test (id , content)
select 4, convert_from('\xA6DB', 'GB18030-2022');
 
insert into tb_test (id , content)
select 5, convert_from('\xA6DC', 'GB18030-2022');
 
insert into tb_test (id , content)
select 6, convert_from('\xA6DD', 'GB18030-2022');
 
insert into tb_test (id , content)
select 7, convert_from('\xA6DE', 'GB18030-2022');
 
insert into tb_test (id , content)
select 8, convert_from('\xA6DF', 'GB18030-2022');
 
insert into tb_test (id , content)
select 9, convert_from('\xA6EC', 'GB18030-2022');
 
insert into tb_test (id , content)
select 10, convert_from('\xA6ED', 'GB18030-2022');
 
insert into tb_test (id , content)
select 11, convert_from('\xA6F3', 'GB18030-2022');
 
insert into tb_test (id , content)
select 12, convert_from('\xFE59', 'GB18030-2022');
 
insert into tb_test (id , content)
select 13, convert_from('\xFE61', 'GB18030-2022');
 
insert into tb_test (id , content)
select 14, convert_from('\xFE66', 'GB18030-2022');
 
insert into tb_test (id , content)
select 15, convert_from('\xFE67', 'GB18030-2022');
 
insert into tb_test (id , content)
select 16, convert_from('\xFE6D', 'GB18030-2022');
 
insert into tb_test (id , content)
select 17, convert_from('\xFE7E', 'GB18030-2022');
 
insert into tb_test (id , content)
select 18, convert_from('\xFE90', 'GB18030-2022');
 
insert into tb_test (id , content)
select 19, convert_from('\xFEA0', 'GB18030-2022');
 
insert into tb_test (id , content) select 20, convert_from('\x8135F437', 'GB18030-2022');
insert into tb_test (id , content) select 21, convert_from('\x84318236', 'GB18030-2022');
insert into tb_test (id , content) select 22, convert_from('\x84318238', 'GB18030-2022');
insert into tb_test (id , content) select 23, convert_from('\x84318237', 'GB18030-2022');
insert into tb_test (id , content) select 24, convert_from('\x84318239', 'GB18030-2022');
insert into tb_test (id , content) select 25, convert_from('\x84318330', 'GB18030-2022');
insert into tb_test (id , content) select 26, convert_from('\x84318331', 'GB18030-2022');
insert into tb_test (id , content) select 27, convert_from('\x84318332', 'GB18030-2022');
insert into tb_test (id , content) select 28, convert_from('\x84318333', 'GB18030-2022');
insert into tb_test (id , content) select 29, convert_from('\x84318334', 'GB18030-2022');
insert into tb_test (id , content) select 30, convert_from('\x84318335', 'GB18030-2022');
insert into tb_test (id , content) select 31, convert_from('\x82359037', 'GB18030-2022');
insert into tb_test (id , content) select 32, convert_from('\x82359038', 'GB18030-2022');
insert into tb_test (id , content) select 33, convert_from('\x82359039', 'GB18030-2022');
insert into tb_test (id , content) select 34, convert_from('\x82359130', 'GB18030-2022');
insert into tb_test (id , content) select 35, convert_from('\x82359131', 'GB18030-2022');
insert into tb_test (id , content) select 36, convert_from('\x82359132', 'GB18030-2022');
insert into tb_test (id , content) select 37, convert_from('\x82359133', 'GB18030-2022');
insert into tb_test (id , content) select 38, convert_from('\x82359134', 'GB18030-2022');
 
--ÊòæÁ§∫Ëøô19‰∏™Â≠óÁ¨¶
select * from tb_test order by id;
 id | content 
----+---------
  1 | ·∏ø
  2 | Ô∏ê
  3 | Ô∏í
  4 | Ô∏ë
  5 | Ô∏ì
  6 | Ô∏î
  7 | Ô∏ï
  8 | Ô∏ñ
  9 | Ô∏ó
 10 | Ô∏ò
 11 | Ô∏ô
 12 | Èæ¥
 13 | Èæµ
 14 | Èæ∂
 15 | Èæ∑
 16 | Èæ∏
 17 | Èæπ
 18 | Èæ∫
 19 | Èæª
 20 | Óüá
 21 | Óûç
 22 | Óûé
 23 | Óûè
 24 | Óûê
 25 | Óûë
 26 | Óûí
 27 | Óûì
 28 | Óûî
 29 | Óûï
 30 | Óûñ
 31 | Ó†û
 32 | Ó†¶
 33 | Ó†´
 34 | Ó†¨
 35 | Ó†≤
 36 | Ó°É
 37 | Ó°î
 38 | Ó°§
(38 rows)

--Êü•ÁúãGB18030-2022ÁºñÁ†Å
select convert_to(content, 'GB18030-2022') from tb_test order by id;
 convert_to 
------------
 \xa8bc
 \xa6d9
 \xa6da
 \xa6db
 \xa6dc
 \xa6dd
 \xa6de
 \xa6df
 \xa6ec
 \xa6ed
 \xa6f3
 \xfe59
 \xfe61
 \xfe66
 \xfe67
 \xfe6d
 \xfe7e
 \xfe90
 \xfea0
 \x8135f437
 \x84318236
 \x84318238
 \x84318237
 \x84318239
 \x84318330
 \x84318331
 \x84318332
 \x84318333
 \x84318334
 \x84318335
 \x82359037
 \x82359038
 \x82359039
 \x82359130
 \x82359131
 \x82359132
 \x82359133
 \x82359134
(38 rows)

--Êü•ÁúãGB18030-2000ÁºñÁ†Å
select convert_to(content, 'GB18030') from tb_test order by id;
 convert_to 
------------
 \xa8bc
 \xa6d9
 \xa6da
 \xa6db
 \xa6dc
 \xa6dd
 \xa6de
 \xa6df
 \xa6ec
 \xa6ed
 \xa6f3
 \xfe59
 \xfe61
 \xfe66
 \xfe67
 \xfe6d
 \xfe7e
 \xfe90
 \xfea0
 \x8135f437
 \x84318236
 \x84318238
 \x84318237
 \x84318239
 \x84318330
 \x84318331
 \x84318332
 \x84318333
 \x84318334
 \x84318335
 \x82359037
 \x82359038
 \x82359039
 \x82359130
 \x82359131
 \x82359132
 \x82359133
 \x82359134
(38 rows)

--ËΩ¨Êç¢‰∏∫UTF-8ÁºñÁ†ÅÔºåUTF-8ÊòØUnicodeÁöÑËÆ°ÁÆóÊú∫ÁºñÁ†ÅÂΩ¢ÂºèÔºåÊÉ≥ÊòæÁ§∫‰∏∫UnicodeÁºñÁ†ÅËøòÈúÄËøõ‰∏ÄÊ≠•ËΩ¨Êç¢ÔºåÊï∞ÊçÆÂ∫ì‰∏≠‰∏çÊîØÊåÅÊ≠§ÂäüËÉΩ„ÄÇ
select convert_to(content, 'utf8') from tb_test order by id;
 convert_to 
------------
 \xe1b8bf
 \xefb890
 \xefb892
 \xefb891
 \xefb893
 \xefb894
 \xefb895
 \xefb896
 \xefb897
 \xefb898
 \xefb899
 \xe9beb4
 \xe9beb5
 \xe9beb6
 \xe9beb7
 \xe9beb8
 \xe9beb9
 \xe9beba
 \xe9bebb
 \xee9f87
 \xee9e8d
 \xee9e8e
 \xee9e8f
 \xee9e90
 \xee9e91
 \xee9e92
 \xee9e93
 \xee9e94
 \xee9e95
 \xee9e96
 \xeea09e
 \xeea0a6
 \xeea0ab
 \xeea0ac
 \xeea0b2
 \xeea183
 \xeea194
 \xeea1a4
(38 rows)

 
 
--2. Êñ∞Â¢ûÂ≠óÁ¨¶‰∏æ‰æã
--CBJÁªü‰∏ÄÊ±âÂ≠óÊâ©ÂÖÖB
select convert_from('\x95328236', 'GB18030-2022');
 convert_from 
--------------
 †ÄÄ
(1 row)

select convert_from('\x9835F336', 'GB18030-2022');
 convert_from 
--------------
 ™õñ
(1 row)

--CJKÁªü‰∏ÄÊ±âÂ≠ó
select convert_from('\x82358F33', 'GB18030-2022');
 convert_from 
--------------
 Èæ¶
(1 row)

select convert_from('\x82359636', 'GB18030-2022');
 convert_from 
--------------
 ÈøØ
(1 row)

--CJKÁªü‰∏ÄÊ±âÂ≠êÊâ©ÂÖÖC
select convert_from('\x9835F738', 'GB18030-2022');
 convert_from 
--------------
 ™úÄ
(1 row)

select convert_from('\x98399E36', 'GB18030-2022');
 convert_from 
--------------
 ´ú¥
(1 row)

--CJKÁªü‰∏ÄÊ±âÂ≠êÊâ©ÂÖÖD
select convert_from('\x98399F38', 'GB18030-2022');
 convert_from 
--------------
 ´ùÄ
(1 row)

select convert_from('\x9839B539', 'GB18030-2022');
 convert_from 
--------------
 ´†ù
(1 row)

--CJKÁªü‰∏ÄÊ±âÂ≠êÊâ©ÂÖÖE
select convert_from('\x9839B632', 'GB18030-2022');
 convert_from 
--------------
 ´††
(1 row)

select convert_from('\x9933FE33', 'GB18030-2022');
 convert_from 
--------------
 ¨∫°
(1 row)

--CJKÁªü‰∏ÄÊ±âÂ≠êÊâ©ÂÖÖF
select convert_from('\x99348138', 'GB18030-2022');
 convert_from 
--------------
 ¨∫∞
(1 row)

select convert_from('\x9939F730', 'GB18030-2022');
 convert_from 
--------------
 ÆØ†
(1 row)

--Â∫∑ÁÜôÈÉ®È¶ñ
select convert_from('\x81398B32', 'GB18030-2022');
 convert_from 
--------------
 ‚ºÄ
(1 row)

select convert_from('\x8139A035', 'GB18030-2022');
 convert_from 
--------------
 ‚øï
(1 row)

--Ë•øÂèåÁâàÁ∫≥Êñ∞ÂÇ£ÊñáÂ≠óÁ¨¶
select convert_from('\x8134F932', 'GB18030-2022');
 convert_from 
--------------
 ·¶Ä
(1 row)

select convert_from('\x81358437', 'GB18030-2022');
 convert_from 
--------------
 ·ßü
(1 row)

--Ë•øÂèåÁâàÁ∫≥ËÄÅÂÇ£ÊñáÂ≠óÁ¨¶
select convert_from('\x81358B32', 'GB18030-2022');
 convert_from 
--------------
 ·®†
(1 row)

select convert_from('\x81359933', 'GB18030-2022');
 convert_from 
--------------
 ·™≠
(1 row)

--ÂÇàÂÉ≥ÊñáÂ≠óÁ¨¶
select convert_from('\x82369535', 'GB18030-2022');
 convert_from 
--------------
 Íìê
(1 row)

select convert_from('\x82369A32', 'GB18030-2022');
 convert_from 
--------------
 Íìø
(1 row)

--ËíôÂè§ÊñáBIRGAÁ¨¶Âè∑
select convert_from('\x9034C538', 'GB18030-2022');
 convert_from 
--------------
 ëô†
(1 row)

select convert_from('\x9034C730', 'GB18030-2022');
 convert_from 
--------------
 ëô¨
(1 row)

--Êªá‰∏úÂåóËãóÊñáÂ≠óÁ¨¶
select convert_from('\x9232C636', 'GB18030-2022');
 convert_from 
--------------
 ñºÄ
(1 row)

select convert_from('\x9232D625', 'GB18030-2022');
 convert_from 
--------------
 ñæè
(1 row)

 
--ÊèíÂÖ•‰∫ÜÊ∂âÂèä2000ÂçáÁ∫ßÂà∞2022Êñ∞Â¢ûÁöÑÂ≠óÁ¨¶‰∏æ‰æã
create table in_test(id int, content text);
 
--CBJÁªü‰∏ÄÊ±âÂ≠óÊâ©ÂÖÖB
insert into in_test (id , content)
select 1,convert_from('\x95328236', 'GB18030-2022');
 
insert into in_test (id , content)
select 2,convert_from('\x9835F336', 'GB18030-2022');
 
--CJKÁªü‰∏ÄÊ±âÂ≠ó
insert into in_test (id , content)
select 3,convert_from('\x82358F33', 'GB18030-2022');
 
insert into in_test (id , content)
select 4,convert_from('\x82359636', 'GB18030-2022');
 
--CJKÁªü‰∏ÄÊ±âÂ≠êÊâ©ÂÖÖC
insert into in_test (id , content)
select 5,convert_from('\x9835F738', 'GB18030-2022');
 
insert into in_test (id , content)
select 6,convert_from('\x98399E36', 'GB18030-2022');
 
--CJKÁªü‰∏ÄÊ±âÂ≠êÊâ©ÂÖÖD
insert into in_test (id , content)
select 7,convert_from('\x98399F38', 'GB18030-2022');
 
insert into in_test (id , content)
select 8,convert_from('\x9839B539', 'GB18030-2022');
 
--CJKÁªü‰∏ÄÊ±âÂ≠êÊâ©ÂÖÖE
insert into in_test (id , content)
select 9,convert_from('\x9839B632', 'GB18030-2022');
 
insert into in_test (id , content)
select 10,convert_from('\x9933FE33', 'GB18030-2022');
 
--CJKÁªü‰∏ÄÊ±âÂ≠êÊâ©ÂÖÖF
insert into in_test (id , content)
select 11,convert_from('\x99348138', 'GB18030-2022');
 
insert into in_test (id , content)
select 12,convert_from('\x9939F730', 'GB18030-2022');
 
--Â∫∑ÁÜôÈÉ®È¶ñ
insert into in_test (id , content)
select 13,convert_from('\x81398B32', 'GB18030-2022');
 
insert into in_test (id , content)
select 14,convert_from('\x8139A035', 'GB18030-2022');
 
--Ë•øÂèåÁâàÁ∫≥Êñ∞ÂÇ£ÊñáÂ≠óÁ¨¶
insert into in_test (id , content)
select 15,convert_from('\x8134F932', 'GB18030-2022');
 
insert into in_test (id , content)
select 16,convert_from('\x81358437', 'GB18030-2022');
 
--Ë•øÂèåÁâàÁ∫≥ËÄÅÂÇ£ÊñáÂ≠óÁ¨¶
insert into in_test (id , content)
select 17,convert_from('\x81358B32', 'GB18030-2022');
 
insert into in_test (id , content)
select 18,convert_from('\x81359933', 'GB18030-2022');
 
--ÂÇàÂÉ≥ÊñáÂ≠óÁ¨¶
insert into in_test (id , content)
select 19,convert_from('\x82369535', 'GB18030-2022');
 
insert into in_test (id , content)
select 20,convert_from('\x82369A32', 'GB18030-2022');
 
--ËíôÂè§ÊñáBIRGAÁ¨¶Âè∑
insert into in_test (id , content)
select 21,convert_from('\x9034C538', 'GB18030-2022');
 
insert into in_test (id , content)
select 22,convert_from('\x9034C730', 'GB18030-2022');
 
--Êªá‰∏úÂåóËãóÊñáÂ≠óÁ¨¶
insert into in_test (id , content)
select 23,convert_from('\x9232C636', 'GB18030-2022');
 
insert into in_test (id , content)
select 24,convert_from('\x9232D625', 'GB18030-2022');
 
--ÊòæÁ§∫Ëøô24‰∏™Â≠óÁ¨¶
select * from in_test order by id;
 id | content 
----+---------
  1 | †ÄÄ
  2 | ™õñ
  3 | Èæ¶
  4 | ÈøØ
  5 | ™úÄ
  6 | ´ú¥
  7 | ´ùÄ
  8 | ´†ù
  9 | ´††
 10 | ¨∫°
 11 | ¨∫∞
 12 | ÆØ†
 13 | ‚ºÄ
 14 | ‚øï
 15 | ·¶Ä
 16 | ·ßü
 17 | ·®†
 18 | ·™≠
 19 | Íìê
 20 | Íìø
 21 | ëô†
 22 | ëô¨
 23 | ñºÄ
 24 | ñæè
(24 rows)

--Êü•ÁúãGB18030-2022ÁºñÁ†Å
select convert_to(content, 'GB18030-2022') from in_test order by id;
 convert_to 
------------
 \x95328236
 \x9835f336
 \x82358f33
 \x82359636
 \x9835f738
 \x98399e36
 \x98399f38
 \x9839b539
 \x9839b632
 \x9933fe33
 \x99348138
 \x9939f730
 \x81398b32
 \x8139a035
 \x8134f932
 \x81358437
 \x81358b32
 \x81359933
 \x82369535
 \x82369a32
 \x9034c538
 \x9034c730
 \x9232c636
 \x9232d625
(24 rows)

--ËΩ¨Êç¢‰∏∫UTF-8ÁºñÁ†ÅÔºåUTF-8ÊòØUnicodeÁöÑËÆ°ÁÆóÊú∫ÁºñÁ†ÅÂΩ¢ÂºèÔºåÊÉ≥ÊòæÁ§∫‰∏∫UnicodeÁºñÁ†ÅËøòÈúÄËøõ‰∏ÄÊ≠•ËΩ¨Êç¢ÔºåÊï∞ÊçÆÂ∫ì‰∏≠‰∏çÊîØÊåÅÊ≠§ÂäüËÉΩ„ÄÇ
select convert_to(content, 'utf8') from in_test order by id;
 convert_to 
------------
 \xf0a08080
 \xf0aa9b96
 \xe9bea6
 \xe9bfaf
 \xf0aa9c80
 \xf0ab9cb4
 \xf0ab9d80
 \xf0aba09d
 \xf0aba0a0
 \xf0acbaa1
 \xf0acbab0
 \xf0aeafa0
 \xe2bc80
 \xe2bf95
 \xe1a680
 \xe1a79f
 \xe1a8a0
 \xe1aaad
 \xea9390
 \xea93bf
 \xf09199a0
 \xf09199ac
 \xf096bc80
 \xf096be8f
(24 rows)

 
drop table in_test;
drop table tb_test;
 
--3. Ê≠£Â∏∏ÁöÑÂ¢ûÂà†ÊîπÊü•ËØ≠Âè•ÊµãËØï
create table Ë°®1(id int, ‰∫∫Âêç name);
 
insert into Ë°®1(id, ‰∫∫Âêç) values(1, 'Â∞èÊòéÔºÅ');
select * from Ë°®1;
 id |  ‰∫∫Âêç  
----+--------
  1 | Â∞èÊòéÔºÅ
(1 row)

 
alter table Ë°®1 drop ‰∫∫Âêç;
select * from Ë°®1;
 id 
----
  1
(1 row)

 
alter table Ë°®1 add Â≠¶Ê†° text;
insert into Ë°®1(id , Â≠¶Ê†°) select 2, convert_to('@Âçé‰∏∫Â§ßÂ≠¶Ôø•', 'GB18030-2022');
select * from Ë°®1;
 id |           Â≠¶Ê†°           
----+--------------------------
  1 | 
  2 | \x40bbaaceaab4f3d1a7a3a4
(2 rows)

 
drop table Ë°®1;
 
--4. ‰∏çÂ≠òÂú®Êò†Â∞ÑÂÖ≥Á≥ªÊó∂
select convert('\xFD308130', 'GB18030-2022', 'UTF8');
ERROR:  character with byte sequence 0xfd 0x30 0x81 0x30 in encoding "GB18030_2022" has no equivalent in encoding "UTF8"
CONTEXT:  referenced column: convert
select convert('\xFE39FE39', 'GB18030-2022', 'UTF8');
ERROR:  character with byte sequence 0xfe 0x39 0xfe 0x39 in encoding "GB18030_2022" has no equivalent in encoding "UTF8"
CONTEXT:  referenced column: convert
 
--5. ÊµãËØïgb18030_2022Êï∞ÊçÆÂ∫ì‰∏≠ÁöÑÂ≠óÁ¨¶‰∏≤Áõ∏ÂÖ≥
-- E021-03 character string literals
SELECT 'first line'
' - next line'
	' - third line'
	AS "Three lines to one";
         Three lines to one          
-------------------------------------
 first line - next line - third line
(1 row)

 
-- illegal string continuation syntax
SELECT 'first line'
' - next line' /* this comment is not allowed here */
' - third line'
	AS "Illegal comment within continuation";
ERROR:  syntax error at or near "' - third line'"
LINE 3: ' - third line'
        ^
 
-- Unicode escapes
SET standard_conforming_strings TO on;
 
SELECT U&'d\0061t\+000061' AS U&"d\0061t\+000061";
 data 
------
 data
(1 row)

SELECT U&'d!0061t\+000061' UESCAPE '!' AS U&"d*0061t\+000061" UESCAPE '*';
 dat\+000061 
-------------
 dat\+000061
(1 row)

 
-- bytea
SET bytea_output TO hex;
SELECT E'\\xDeAdBeEf'::bytea;
   bytea    
------------
 \xdeadbeef
(1 row)

SELECT E'\\x De Ad Be Ef '::bytea;
   bytea    
------------
 \xdeadbeef
(1 row)

SELECT E'\\xDeAdBeE'::bytea;
ERROR:  invalid hexadecimal data: odd number of digits
LINE 1: SELECT E'\\xDeAdBeE'::bytea;
               ^
CONTEXT:  referenced column: bytea
SELECT E'\\xDeAdBeEx'::bytea;
ERROR:  invalid hexadecimal digit: "x"
LINE 1: SELECT E'\\xDeAdBeEx'::bytea;
               ^
CONTEXT:  referenced column: bytea
SELECT E'\\xDe00BeEf'::bytea;
   bytea    
------------
 \xde00beef
(1 row)

SELECT E'DeAdBeEf'::bytea;
       bytea        
--------------------
 \x4465416442654566
(1 row)

SELECT E'De\\000dBeEf'::bytea;
       bytea        
--------------------
 \x4465006442654566
(1 row)

SELECT E'De\123dBeEf'::bytea;
       bytea        
--------------------
 \x4465536442654566
(1 row)

SELECT E'De\\123dBeEf'::bytea;
       bytea        
--------------------
 \x4465536442654566
(1 row)

SELECT E'De\\678dBeEf'::bytea;
ERROR:  invalid input syntax for type bytea
LINE 1: SELECT E'De\\678dBeEf'::bytea;
               ^
CONTEXT:  referenced column: bytea
 
SET bytea_output TO escape;
SELECT E'\\xDeAdBeEf'::bytea;
      bytea       
------------------
 \336\255\276\357
(1 row)

SELECT E'\\x De Ad Be Ef '::bytea;
      bytea       
------------------
 \336\255\276\357
(1 row)

SELECT E'\\xDe00BeEf'::bytea;
      bytea       
------------------
 \336\000\276\357
(1 row)

SELECT E'DeAdBeEf'::bytea;
  bytea   
----------
 DeAdBeEf
(1 row)

SELECT E'De\\000dBeEf'::bytea;
    bytea    
-------------
 De\000dBeEf
(1 row)

SELECT E'De\\123dBeEf'::bytea;
  bytea   
----------
 DeSdBeEf
(1 row)

 
SET bytea_output TO hex;
 
SELECT CAST(name 'namefield' AS text) AS "text(name)";
 text(name) 
------------
 namefield
(1 row)

 
-- E021-09 trim function
SELECT TRIM(BOTH FROM '  bunch o blanks  ') = 'bunch o blanks' AS "bunch o blanks";
 bunch o blanks 
----------------
 t
(1 row)

 
-- E021-06 substring expression
SELECT SUBSTRING('1234567890' FROM 3) = '34567890' AS "34567890";
 34567890 
----------
 t
(1 row)

 
-- PostgreSQL extension to allow using back reference in replace string;
SELECT regexp_replace('1112223333', E'(\\d{3})(\\d{3})(\\d{4})', E'(\\1) \\2-\\3');
 regexp_replace 
----------------
 (111) 222-3333
(1 row)

 
-- set so we can tell NULL from empty string
\pset null '\\N'
 
-- return all matches from regexp
SELECT regexp_matches('foobarbequebaz', $re$(bar)(beque)$re$);
 regexp_matches 
----------------
 {bar,beque}
(1 row)

 
-- split string on regexp
SELECT foo, length(foo) FROM regexp_split_to_table('the quick brown fox jumped over the lazy dog', $re$\s+$re$) AS foo;
  foo   | length 
--------+--------
 the    |      3
 quick  |      5
 brown  |      5
 fox    |      3
 jumped |      6
 over   |      4
 the    |      3
 lazy   |      4
 dog    |      3
(9 rows)

SELECT regexp_split_to_array('the quick brown fox jumped over the lazy dog', $re$\s+$re$);
             regexp_split_to_array              
------------------------------------------------
 {the,quick,brown,fox,jumped,over,the,lazy,dog}
(1 row)

 
-- change NULL-display back
\pset null ''
 
-- E021-11 position expression
SELECT POSITION('4' IN '1234567890') = '4' AS "4";
 4 
---
 t
(1 row)

 
SELECT POSITION('5' IN '1234567890') = '5' AS "5";
 5 
---
 t
(1 row)

 
-- T312 character overlay function
SELECT OVERLAY('abcdef' PLACING '45' FROM 4) AS "abc45f";
 abc45f 
--------
 abc45f
(1 row)

 
-- E061-04 like predicate
SELECT 'hawkeye' LIKE 'h%' AS "true";
 true 
------
 t
(1 row)

SELECT 'hawkeye' NOT LIKE 'h%' AS "false";
 false 
-------
 f
(1 row)

 
-- unused escape character
SELECT 'hawkeye' LIKE 'h%' ESCAPE '#' AS "true";
 true 
------
 t
(1 row)

SELECT 'hawkeye' NOT LIKE 'h%' ESCAPE '#' AS "false";
 false 
-------
 f
(1 row)

 
--
-- test ILIKE (case-insensitive LIKE)
-- Be sure to form every test as an ILIKE/NOT ILIKE pair.
--
 
SELECT 'hawkeye' ILIKE 'h%' AS "true";
 true 
------
 t
(1 row)

SELECT 'hawkeye' NOT ILIKE 'h%' AS "false";
 false 
-------
 f
(1 row)

 
--6. ‰ΩøÁî®Â≠óÁ¨¶‰∏≤Áõ∏ÂÖ≥ÂáΩÊï∞
--ÈáçÂ§çÂ≠óÁ¨¶‰∏≤
select repeat('‰∏≠ÂõΩ', 3);
    repeat    
--------------
 ‰∏≠ÂõΩ‰∏≠ÂõΩ‰∏≠ÂõΩ
(1 row)

 
--ËøîÂõûÂ≠óÁ¨¶‰∏≤ÁöÑÂâçn‰∏™Â≠óÁ¨¶
select left('‰∏≠ÂõΩÔºÅnumber1', 7);
    left    
------------
 ‰∏≠ÂõΩÔºÅnumb
(1 row)

 
--ËøîÂõûÈïøÂ∫¶
select length('‰∏≠ÂõΩÔºÅnumber1');
 length 
--------
     10
(1 row)

 
--ÂèçËΩ¨Â≠óÁ¨¶‰∏≤
select reverse('‰∏≠ÂõΩÔºÅnumber1');
    reverse    
---------------
 1rebmunÔºÅÂõΩ‰∏≠
(1 row)

 
--md5ÁÆóÊ≥ïÂä†ÂØÜ
select md5('‰∏≠ÂõΩÔºÅnumber1');
               md5                
----------------------------------
 764c69059680eb8f52946f9f4936737a
(1 row)

 
-- test strpos
SELECT strpos('abcdef', 'cd') AS "pos_3";
 pos_3 
-------
     3
(1 row)

SELECT strpos('abcdef', 'xy') AS "pos_0";
 pos_0 
-------
     0
(1 row)

 
SELECT replace('yabadabadoo', 'ba', '123') AS "ya123da123doo";
 ya123da123doo 
---------------
 ya123da123doo
(1 row)

 
select split_part('joeuser@mydatabase','@',3) AS "empty string";
 empty string 
--------------
 
(1 row)

 
select to_hex(256::bigint*256::bigint*256::bigint*256::bigint - 1) AS "ffffffff";
 ffffffff 
----------
 ffffffff
(1 row)

 
--ËøîÂõûÂ≠óÁ¨¶‰∏≤‰∏≠Á¨¨‰∏Ä‰∏™Â≠óÁ¨¶ÁöÑÂçÅËøõÂà∂Ë°®Á§∫ÂΩ¢Âºè
select ascii('xyz');
 ascii 
-------
   120
(1 row)

select ascii('‰∏≠xyz');
ERROR:  requested character too large
CONTEXT:  referenced column: ascii
select ascii('·∏øxyz');
ERROR:  requested character too large
CONTEXT:  referenced column: ascii
 
-- 7. Ê£ÄÊü•GB18030-2022‰∏éGB18030ÁöÑÂÖ≥Á≥ª
select convert('‰∏≠ÂõΩ', 'GB18030', 'GB18030-2022');
  convert   
------------
 \xd6d0b9fa
(1 row)

 
select convert('‰∏≠ÂõΩ', 'GB18030-2022', 'GB18030');
  convert   
------------
 \xd6d0b9fa
(1 row)

 
select convert('\xA8BC', 'GB18030-2022', 'UTF8');
 convert  
----------
 \xe1b8bf
(1 row)

 
select convert('\xA8BC', 'GB18030', 'UTF8');
 convert  
----------
 \xee9f87
(1 row)

 
\c regression
clean connection to all force for database gb18030_2022;
drop database gb18030_2022;
 
-- 8. Âú®UTF8ÁéØÂ¢É‰∏ãÊ£ÄÊµãGB18030-2022‰∏éUTF8ÁöÑËΩ¨Êç¢
select convert('‰∏≠ÂõΩ&Âçé‰∏∫*GaussDB', 'UTF8', 'GB18030-2022');
               convert                
--------------------------------------
 \xd6d0b9fa26bbaaceaa2a47617573734442
(1 row)

 
select convert('·∏ø', 'UTF8', 'GB18030-2022');
 convert 
---------
 \xa8bc
(1 row)

 
-- 9. ÊµãËØïcreate databaseÊó∂encoding‰∏éÊú¨Âú∞ËÆæÁΩÆ‰∏çÂåπÈÖç
create database gb18030_2022 encoding='gb18030-2022' LC_COLLATE='en_US.utf-8' LC_CTYPE ='en_US.utf-8' TEMPLATE=template0;
ERROR:  encoding "GB18030_2022" does not match locale "en_US.utf-8"
DETAIL:  The chosen LC_CTYPE setting requires encoding "UTF8".
 
--10. ÊµãËØïinitdb
\! rm -f @abs_bindir@/test_initdb.log
\! mkdir -p @testtablespace@/test2
\! mkdir -p @testtablespace@/test2/pg_location
\! @abs_bindir@/gs_initdb -S -D @testtablespace@/test2 --nodename coorn2 -U test_initdb -w test@123 --locale=zh_CN.gb18030 -E GB18030_2022 >> @abs_bindir@/test_initdb2.log 2>&1
\! cat @abs_bindir@/test_initdb2.log | grep ok
ok
creating subdirectories ... in ordinary occasionok
creating configuration files ... ok
ok
initializing pg_authid ... ok
setting password ... ok
initializing dependencies ... ok
loading PL/pgSQL server-side language ... ok
creating system views ... ok
creating performance views ... ok
loading system objects' descriptions ... ok
creating collations ... ok
creating conversions ... ok
creating dictionaries ... ok
setting privileges on built-in objects ... ok
initialize global configure for bucketmap length ... ok
creating information schema ... ok
loading foreign-data wrapper for distfs access ... ok
loading foreign-data wrapper for log access ... ok
loading hstore extension ... ok
loading security plugin ... ok
update system tables ... ok
creating snapshots catalog ... ok
vacuuming database template1 ... ok
copying template1 to template0 ... ok
copying template1 to postgres ... ok
freezing database template0 ... ok
freezing database template1 ... ok
freezing database postgres ... ok
\! rm -f @abs_bindir@/test_initdb2.log
\! rm -rf @testtablespace@/test2
 
--11. ÊµãËØïÂçáÁ∫ßÂõûÊªö
select oid, * from pg_conversion where conname like '%gb18030%' order by conname;
  oid  |       conname        | connamespace | conowner | conforencoding | contoencoding |       conproc        | condefault 
-------+----------------------+--------------+----------+----------------+---------------+----------------------+------------
--? .* | gb18030_2022_to_utf8 |           11 |       10 |             37 |             7 | gb18030_2022_to_utf8 | t
--? .* | gb18030_to_utf8      |           11 |       10 |             36 |             7 | gb18030_to_utf8      | t
--? .* | utf8_to_gb18030      |           11 |       10 |              7 |            36 | utf8_to_gb18030      | t
--? .* | utf8_to_gb18030_2022 |           11 |       10 |              7 |            37 | utf8_to_gb18030_2022 | t
(4 rows)

 
select oid, * from pg_proc where proname like '%gb18030%' order by proname;
  oid  |       proname        | pronamespace | proowner | prolang | procost | prorows | provariadic | protransform | proisagg | proiswindow | prosecdef | proleakproof | proisstrict | proretset | provolatile | pronargs | pronargdefaults | prorettype |    proargtypes     | proallargtypes | proargmodes | proargnames | proargdefaults |        prosrc        |          probin          | proconfig | proacl | prodefaultargpos | fencedmode | proshippable | propackage | prokind | proargsrc | propackageid | proisprivate | proargtypesext | prodefaultargposext |    allargtypes     | allargtypesext 
-------+----------------------+--------------+----------+---------+---------+---------+-------------+--------------+----------+-------------+-----------+--------------+-------------+-----------+-------------+----------+-----------------+------------+--------------------+----------------+-------------+-------------+----------------+----------------------+--------------------------+-----------+--------+------------------+------------+--------------+------------+---------+-----------+--------------+--------------+----------------+---------------------+--------------------+----------------
--? .* | gb18030_2022_to_utf8 |           11 |       10 |      13 |       1 |       0 |           0 | -            | f        | f           | f         | f            | t           | f         | v           |        5 |               0 |       2278 | 23 23 2275 2281 23 |                |             |             |                | gb18030_2022_to_utf8 | $libdir/utf8_and_gb18030 |           |        |                  | f          | f            | f          | f       |           |            0 | f            |                |                     | 23 23 2275 2281 23 | 
--? .* | gb18030_to_utf8      |           11 |       10 |      13 |       1 |       0 |           0 | -            | f        | f           | f         | f            | t           | f         | v           |        5 |               0 |       2278 | 23 23 2275 2281 23 |                |             |             |                | gb18030_to_utf8      | $libdir/utf8_and_gb18030 |           |        |                  | f          | f            | f          | f       |           |            0 | f            |                |                     | 23 23 2275 2281 23 | 
--? .* | utf8_to_gb18030      |           11 |       10 |      13 |       1 |       0 |           0 | -            | f        | f           | f         | f            | t           | f         | v           |        5 |               0 |       2278 | 23 23 2275 2281 23 |                |             |             |                | utf8_to_gb18030      | $libdir/utf8_and_gb18030 |           |        |                  | f          | f            | f          | f       |           |            0 | f            |                |                     | 23 23 2275 2281 23 | 
--? .* | utf8_to_gb18030_2022 |           11 |       10 |      13 |       1 |       0 |           0 | -            | f        | f           | f         | f            | t           | f         | v           |        5 |               0 |       2278 | 23 23 2275 2281 23 |                |             |             |                | utf8_to_gb18030_2022 | $libdir/utf8_and_gb18030 |           |        |                  | f          | f            | f          | f       |           |            0 | f            |                |                     | 23 23 2275 2281 23 | 
(4 rows)

 
--12. ÁúãÊä§client_encoding‰∏çËÉΩËÆæÁΩÆ‰∏∫GB18030_2022
set client_encoding = GB18030_2022;
ERROR:  invalid value for parameter "client_encoding": "gb18030_2022"
 
ALTER SESSION SET NAMES 'GB18030_2022';
ERROR:  invalid value for parameter "client_encoding": "GB18030_2022"
