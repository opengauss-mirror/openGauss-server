CREATE ROLE dfm PASSWORD 'Gauss@123';
SELECT a.rolname, n.nspname FROM pg_authid a JOIN pg_namespace n ON (a.oid = n.nspowner AND a.rolname='dfm');
 rolname | nspname 
---------+---------
(0 rows)

DROP ROLE dfm;
CREATE USER dfm PASSWORD 'Gauss@123';
SELECT a.rolname, n.nspname FROM pg_authid a JOIN pg_namespace n ON (a.oid = n.nspowner AND a.rolname='dfm');
 rolname | nspname 
---------+---------
 dfm     | dfm
(1 row)

CREATE TABLESPACE dfm LOCATION '@testtablespace@';
SHOW search_path;
  search_path   
----------------
 "$user",public
(1 row)

SHOW default_tablespace;
 default_tablespace 
--------------------
 
(1 row)

SET search_path='dfm';
SHOW search_path;
 search_path 
-------------
 dfm
(1 row)

SHOW default_tablespace;
 default_tablespace 
--------------------
 
(1 row)

DROP USER dfm;
SHOW search_path;
 search_path 
-------------
 dfm
(1 row)

SHOW default_tablespace;
 default_tablespace 
--------------------
 
(1 row)

SELECT nspname from pg_namespace where nspname='dfm';
 nspname 
---------
(0 rows)

RESET search_path;
RESET default_tablespace;
CREATE USER dfm PASSWORD 'Gauss@123';
SET SESSION AUTHORIZATION dfm PASSWORD 'Gauss@123';
SHOW search_path;
  search_path   
----------------
 "$user",public
(1 row)

SHOW default_tablespace;
 default_tablespace 
--------------------
 
(1 row)

DROP USER dfm;
ERROR:  Permission denied to drop role.
RESET SESSION AUTHORIZATION;
SET search_path='dfm';
--can not drop current schema
DROP USER dfm CASCADE;
ERROR:  fail to drop the current schema
SELECT nspname from pg_namespace where nspname='dfm';
 nspname 
---------
 dfm
(1 row)

DROP TABLESPACE dfm;
--test audit for set role/session rollback
CREATE USER SET_SESSION_ROLLBACK_AUDIT PASSWORD 'GAUSS@123';
START TRANSACTION;
SET SESSION SESSION AUTHORIZATION SET_SESSION_ROLLBACK_AUDIT PASSWORD 'GAUSS@123';
CREATE USER SET_SESSION_ROLLBACK_AUDIT_TABLE IDENTIFIED BY 'GAUSS@123';
ERROR:  Permission denied to create role.
COMMIT;
DROP USER SET_SESSION_ROLLBACK_AUDIT;
REVOKE ALL on schema public FROM public;
create role test_revoke_for_sysadmin login sysadmin password 'Gauss@123';
clean connection to all check to user test_revoke_for_sysadmin;
\! @abs_bindir@/gsql -d postgres -p @portstring@ -U test_revoke_for_sysadmin -W Gauss@123 -c "create table public.test_revoke_for_sysadmin_table(id int);drop table public.test_revoke_for_sysadmin_table;"
CREATE TABLE
DROP TABLE
drop role test_revoke_for_sysadmin;
GRANT ALL on schema public TO public;
--test set role/session error with wrong username or password
create role wrong_role password 'Gauss@123';
set role wrong_role password 'Gauss@1234';
ERROR:  Invalid username/password,set role denied.
\! sleep 1
set role null_role password 'Gauss@123';
ERROR:  Invalid username/password,set role denied.
\! sleep 1
set session authorization wrong_role password 'Gauss@1234';
ERROR:  Invalid username/password,set session_authorization denied.
\! sleep 1
set session authorization null_role password 'Gauss@123';
ERROR:  Invalid username/password,set session_authorization denied.
\! sleep 1
drop role wrong_role;
--test nouser can alter set initial account
create user alter_set_initial_user sysadmin password 'gauss@123';
DECLARE C_USER VARCHAR(100);
BEGIN
EXECUTE IMMEDIATE 'select user' INTO C_USER;
EXECUTE IMMEDIATE ('set role alter_set_initial_user password ''gauss@123'';');
EXECUTE IMMEDIATE ('alter role '||quote_ident(C_USER)||' set session_timeout to ''5min'' ;');
END;
/
ERROR:  Permission denied.
--?.*
PL/pgSQL function inline_code_block line 5 at EXECUTE statement
reset role;
drop user alter_set_initial_user;
--test createrole can't change itself privileges.
create user createrole_change_itself createrole password 'gauss@123';
set role createrole_change_itself password 'gauss@123';
alter user createrole_change_itself  VALID BEGIN '1111-11-11' VALID until '2222-12-12';
ERROR:  Permission denied.
reset role;
drop user createrole_change_itself;
--
-- drop database
--
create database a1qazse4;
\c a1qazse4;
\! @gsqldir@/gsql -d postgres -p @portstring@ -c "drop database a1qazse4"
ERROR:  Database "a1qazse4" is being accessed by other users. You can stop all connections by command: "clean connection to all force for database XXXX;" or wait for the sessions to end by querying view: "pg_stat_activity".
--?DETAIL:  There is.*
\c postgres; 
drop database a1qazse4;
--
-- test audit for new object
--
-- open the audit guc parameter.
\! @abs_bindir@/gs_guc reload -Z coordinator -D @abs_srcdir@/tmp_check/coordinator1/ -c "audit_system_object=8191" > /dev/null 2>&1
select pg_sleep(1);
 pg_sleep 
----------
 
(1 row)

--1��audit for resouce pool and workload.
select * from pg_delete_audit('1111-1-1','2222-2-2');
 pg_delete_audit 
-----------------
 
(1 row)

create resource pool test_resourcepool_audit;
create workload group test_workloadgroup_audit;
ERROR:  Un-support feature
DETAIL:  The distributed capability is not supported currently.
alter workload group test_workloadgroup_audit using resource pool test_resourcepool_audit;
ERROR:  Un-support feature
DETAIL:  The distributed capability is not supported currently.
drop workload group test_workloadgroup_audit;
ERROR:  Un-support feature
DETAIL:  The distributed capability is not supported currently.
drop resource pool test_resourcepool_audit;
select type,result,object_name,detail_info from pg_query_audit('1111-1-1','2222-2-2') where object_name = 'test_resourcepool';
 type | result | object_name | detail_info 
------+--------+-------------+-------------
(0 rows)

select type,result,object_name,detail_info from pg_query_audit('1111-1-1','2222-2-2') where object_name = 'test_workloadgroup';
 type | result | object_name | detail_info 
------+--------+-------------+-------------
(0 rows)

--2��audit for app workload group mapping.
select * from pg_delete_audit('1111-1-1','2222-2-2');
 pg_delete_audit 
-----------------
 
(1 row)

create app workload group mapping test_appworkloadgroupmapping_audit;
ERROR:  Un-support feature
DETAIL:  The distributed capability is not supported currently.
alter app workload group mapping test_appworkloadgroupmapping_audit with (workload_gpname='default_group');
ERROR:  Un-support feature
DETAIL:  The distributed capability is not supported currently.
drop app workload group mapping test_appworkloadgroupmapping_audit;
ERROR:  Un-support feature
DETAIL:  The distributed capability is not supported currently.
select type,result,object_name,detail_info from pg_query_audit('1111-1-1','2222-2-2') where object_name = 'test_appworkloadgroupmapping';
 type | result | object_name | detail_info 
------+--------+-------------+-------------
(0 rows)

--3��audit for server in hardoop
select * from pg_delete_audit('1111-1-1','2222-2-2');
 pg_delete_audit 
-----------------
 
(1 row)

create role temp_role password 'Gauss@123';
create server test_serverforhardoop_audit foreign data wrapper hdfs_fdw options (address '10.10.0.100:25000', hdfscfgpath '/home/omm', type 'hdfs');
ERROR:  foreign-data wrapper "hdfs_fdw" does not exist
--alter server test_serverforhardoop_audit options (add hdfscfgpath '/opt/hadoop');
alter server test_serverforhardoop_audit owner to temp_role;
ERROR:  server "test_serverforhardoop_audit" does not exist
alter server test_serverforhardoop_audit rename to test_serverforhardoop_audit1;
ERROR:  server "test_serverforhardoop_audit" does not exist
drop server test_serverforhardoop_audit1;
ERROR:  server "test_serverforhardoop_audit1" does not exist
drop role temp_role;
select type,result,object_name,detail_info from pg_query_audit('1111-1-1','2222-2-2') where object_name LIKE 'test_serverforhardoop';
 type | result | object_name | detail_info 
------+--------+-------------+-------------
(0 rows)

--4 audit for data source 
create data source ds_tst_102 options (encoding 'utf8', password 'Gs@123456', username 'gaussdb');
ERROR:  No key file datasource.key.cipher
HINT:  Please create datasource.key.cipher file with gs_guc and gs_ssh, such as :gs_ssh -c "gs_guc generate -S XXX -D $GAUSSHOME/bin -o datasource"
alter data source ds_tst_102 type 'MPPDB';
ERROR:  data source "ds_tst_102" does not exist
alter data source ds_tst_102 rename to ds_tst_104;
ERROR:  data source "ds_tst_102" does not exist
create user ds_tst_user_101 identified by 'Gs@123456';
alter user ds_tst_user_101 with sysadmin;
alter data source ds_tst_104 owner to ds_tst_user_101;
ERROR:  data source "ds_tst_104" does not exist
drop data source ds_tst_104;
ERROR:  source "ds_tst_104" does not exist
drop user ds_tst_user_101;
select type,result,object_name,detail_info from pg_query_audit('1111-1-1','2222-2-2') where object_name='ds_tst_001';
 type | result | object_name | detail_info 
------+--------+-------------+-------------
(0 rows)

-- close the audit guc parameter.
\! @abs_bindir@/gs_guc reload -Z coordinator -D @abs_srcdir@/tmp_check/coordinator1/ -c "audit_system_object=7" > /dev/null 2>&1
select pg_sleep(1);
 pg_sleep 
----------
 
(1 row)

create role nologin_privilege_role password 'Gauss@123';
set role nologin_privilege_role password 'Gauss@123';
create table stream_test(id int);
ERROR:  permission denied for schema public
DETAIL:  N/A
insert into stream_test values(1),(2);
ERROR:  relation "stream_test" does not exist on datanode1
LINE 1: insert into stream_test values(1),(2);
                    ^
drop table stream_test;
ERROR:  table "stream_test" does not exist
reset role;
drop role nologin_privilege_role;
--ALTER SYSTEM KILL SESSION '123456789101213,0' IMMEDIATE;
--select pg_stat_get_backend_pid(1);
--select pg_stat_get_activity(123456789101112);
create user sec_app_account_02_001_roleadmin with createrole identified by 'Gauss_234';
\! @abs_bindir@/gsql -d postgres -p @portstring@ -U sec_app_account_02_001_roleadmin -W Gauss_234 -r -c "create user sec_app_account_02_001_testa identified by 'Gauss_234';"
CREATE ROLE
\! @abs_bindir@/gsql -d postgres -p @portstring@ -U sec_app_account_02_001_roleadmin -W Gauss_234 -r -c "drop user sec_app_account_02_001_testa;"
DROP ROLE
drop user sec_app_account_02_001_roleadmin;
--audit for set parameter operator.
select * from pg_delete_audit('1111-1-1','2222-2-2');
 pg_delete_audit 
-----------------
 
(1 row)

create user set_role_user password 'gauss@123';
set role set_role_user password 'gauss@123';
reset role;
drop user set_role_user;
select type,result,object_name,detail_info from pg_query_audit('1111-1-1','2222-2-2') where detail_info like '%set_role_user%';
   type   | result |  object_name  |                  detail_info                   
----------+--------+---------------+------------------------------------------------
 ddl_user | ok     | set_role_user | create user set_role_user password '********';
 ddl_user | ok     | set_role_user | drop user set_role_user;
(2 rows)

select * from pg_delete_audit('1111-1-1','2222-2-2');
 pg_delete_audit 
-----------------
 
(1 row)

------------------------ TESTS FOR PGUSER ------------------------------------------- 
/* These cases are for pguser option test in CreateUserStmt.
 * A user created with pguser option will have a password stored in MD5 format.
 */
create user md5user_default		 with pguser password 'gauss@123';
create user md5user_superuser 	 with pguser sysadmin password 'gauss@123';
create user md5user_createdb 	 with pguser createdb password 'gauss@123';
create user md5user_login 		 with pguser login password 'gauss@123';
create user md5user_inherit 	 with pguser inherit password 'gauss@123';
create user md5user_replication	 with pguser replication password 'gauss@123';
create user md5user_auditadmin 	 with pguser auditadmin password 'gauss@123';
create role md5role_default		 with pguser password 'gauss@123';
create role md5role_superuser 	 with pguser sysadmin password 'gauss@123';
create role md5role_createdb 	 with pguser createdb password 'gauss@123';
create role md5role_login 		 with pguser login password 'gauss@123';
create role md5role_inherit 	 with pguser inherit password 'gauss@123';
create role md5role_replication	 with pguser replication password 'gauss@123';
create role md5role_auditadmin	 with pguser auditadmin password 'gauss@123';
-- Incorrect statements.
create user md5error with pguser pguser password 'gauss@123';
ERROR:  conflicting or redundant options
create role md5error with pguser pguser password 'gauss@123';
ERROR:  conflicting or redundant options
-- some check.
select usename, 
	usecreatedb,
	usesuper,
	usecatupd,
	userepl,
	left(passwd, 3) = 'md5' as ismd5passwd,
	valbegin, 
	valuntil, 
	respool from pg_user where usename ilike 'md5%' order by usename;
       usename       | usecreatedb | usesuper | usecatupd | userepl | ismd5passwd | valbegin | valuntil |   respool    
---------------------+-------------+----------+-----------+---------+-------------+----------+----------+--------------
 md5role_login       | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_auditadmin  | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_createdb    | t           | f        | f         | f       | f           |          |          | default_pool
 md5user_default     | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_inherit     | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_login       | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_replication | f           | f        | f         | t       | f           |          |          | default_pool
 md5user_superuser   | f           | f        | f         | f       | f           |          |          | default_pool
(8 rows)

select usename, 
	usecreatedb, 
	usesuper, 
	usecatupd, 
	userepl, 
	left(passwd, 3) = 'md5' as ismd5passwd,
	valbegin, 
	valuntil, 
	respool from pg_shadow where usename ilike 'md5%' order by usename;
       usename       | usecreatedb | usesuper | usecatupd | userepl | ismd5passwd | valbegin | valuntil |   respool    
---------------------+-------------+----------+-----------+---------+-------------+----------+----------+--------------
 md5role_login       | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_auditadmin  | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_createdb    | t           | f        | f         | f       | f           |          |          | default_pool
 md5user_default     | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_inherit     | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_login       | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_replication | f           | f        | f         | t       | f           |          |          | default_pool
 md5user_superuser   | f           | f        | f         | f       | f           |          |          | default_pool
(8 rows)

select rolname, 
	rolsuper, 
	rolinherit, 
	rolcreaterole, 
	rolcreatedb, 
	rolcatupdate, 
	rolcanlogin, 
	rolreplication,
	rolauditadmin, 
	rolsystemadmin, 
	rolconnlimit, 
	rolpassword, 
	rolvalidbegin, 
	rolvaliduntil, 
	rolrespool, 
	rolconfig
	from pg_roles where rolname ilike 'md5%' order by rolname;
       rolname       | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolreplication | rolauditadmin | rolsystemadmin | rolconnlimit | rolpassword | rolvalidbegin | rolvaliduntil |  rolrespool  | rolconfig 
---------------------+----------+------------+---------------+-------------+--------------+-------------+----------------+---------------+----------------+--------------+-------------+---------------+---------------+--------------+-----------
 md5role_auditadmin  | f        | t          | f             | f           | f            | f           | f              | t             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_createdb    | f        | t          | f             | t           | f            | f           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_default     | f        | t          | f             | f           | f            | f           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_inherit     | f        | t          | f             | f           | f            | f           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_login       | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_replication | f        | t          | f             | f           | f            | f           | t              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_superuser   | f        | t          | f             | f           | f            | f           | f              | f             | t              |           -1 | ********    |               |               | default_pool | 
 md5user_auditadmin  | f        | t          | f             | f           | f            | t           | f              | t             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_createdb    | f        | t          | f             | t           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_default     | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_inherit     | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_login       | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_replication | f        | t          | f             | f           | f            | t           | t              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_superuser   | f        | t          | f             | f           | f            | t           | f              | f             | t              |           -1 | ********    |               |               | default_pool | 
(14 rows)

	
select rolname    ,
	rolsuper,
	rolinherit,
	rolcreaterole,
	rolcreatedb,
	rolcatupdate,
	rolcanlogin,
	rolreplication,
	rolauditadmin,
	rolsystemadmin,
	rolconnlimit,
	left(rolpassword, 3) = 'md5' as ismd5passwd,
	rolvalidbegin,
	rolvaliduntil,
	rolrespool    
	from pg_authid where rolname ilike 'md5%' order by rolname;
       rolname       | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolreplication | rolauditadmin | rolsystemadmin | rolconnlimit | ismd5passwd | rolvalidbegin | rolvaliduntil |  rolrespool  
---------------------+----------+------------+---------------+-------------+--------------+-------------+----------------+---------------+----------------+--------------+-------------+---------------+---------------+--------------
 md5role_auditadmin  | f        | t          | f             | f           | f            | f           | f              | t             | f              |           -1 | f           |               |               | default_pool
 md5role_createdb    | f        | t          | f             | t           | f            | f           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_default     | f        | t          | f             | f           | f            | f           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_inherit     | f        | t          | f             | f           | f            | f           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_login       | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_replication | f        | t          | f             | f           | f            | f           | t              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_superuser   | f        | t          | f             | f           | f            | f           | f              | f             | t              |           -1 | f           |               |               | default_pool
 md5user_auditadmin  | f        | t          | f             | f           | f            | t           | f              | t             | f              |           -1 | f           |               |               | default_pool
 md5user_createdb    | f        | t          | f             | t           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_default     | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_inherit     | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_login       | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_replication | f        | t          | f             | f           | f            | t           | t              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_superuser   | f        | t          | f             | f           | f            | t           | f              | f             | t              |           -1 | f           |               |               | default_pool
(14 rows)

-- Password can be changed by "PGUSER" itself.
set role md5user_default password 'gauss@123';
alter role md5user_default identified by 'gauss@123456' replace 'gauss@123';
-- Reset the connection to user postgres
\c
-- Invalid password
set role md5user_default password 'gauss@123';
ERROR:  Invalid username/password,set role denied.
\c
-- Login normal 
set role md5user_default password 'gauss@123456';
\c
-- The password format of md5user_default should be "md5" still.
select usename, 
	usecreatedb,
	usesuper,
	usecatupd,
	userepl,
	left(passwd, 3) = 'md5' as ismd5passwd,
	valbegin, 
	valuntil, 
	respool from pg_user where usename ilike 'md5%' order by usename;
       usename       | usecreatedb | usesuper | usecatupd | userepl | ismd5passwd | valbegin | valuntil |   respool    
---------------------+-------------+----------+-----------+---------+-------------+----------+----------+--------------
 md5role_login       | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_auditadmin  | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_createdb    | t           | f        | f         | f       | f           |          |          | default_pool
 md5user_default     | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_inherit     | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_login       | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_replication | f           | f        | f         | t       | f           |          |          | default_pool
 md5user_superuser   | f           | f        | f         | f       | f           |          |          | default_pool
(8 rows)

select usename, 
	usecreatedb, 
	usesuper, 
	usecatupd, 
	userepl, 
	left(passwd, 3) = 'md5' as ismd5passwd,
	valbegin, 
	valuntil, 
	respool from pg_shadow where usename ilike 'md5%' order by usename;
       usename       | usecreatedb | usesuper | usecatupd | userepl | ismd5passwd | valbegin | valuntil |   respool    
---------------------+-------------+----------+-----------+---------+-------------+----------+----------+--------------
 md5role_login       | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_auditadmin  | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_createdb    | t           | f        | f         | f       | f           |          |          | default_pool
 md5user_default     | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_inherit     | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_login       | f           | f        | f         | f       | f           |          |          | default_pool
 md5user_replication | f           | f        | f         | t       | f           |          |          | default_pool
 md5user_superuser   | f           | f        | f         | f       | f           |          |          | default_pool
(8 rows)

select rolname, 
	rolsuper, 
	rolinherit, 
	rolcreaterole, 
	rolcreatedb, 
	rolcatupdate, 
	rolcanlogin, 
	rolreplication,
	rolauditadmin, 
	rolsystemadmin, 
	rolconnlimit, 
	rolpassword, 
	rolvalidbegin, 
	rolvaliduntil, 
	rolrespool, 
	rolconfig
	from pg_roles where rolname ilike 'md5%' order by rolname;
       rolname       | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolreplication | rolauditadmin | rolsystemadmin | rolconnlimit | rolpassword | rolvalidbegin | rolvaliduntil |  rolrespool  | rolconfig 
---------------------+----------+------------+---------------+-------------+--------------+-------------+----------------+---------------+----------------+--------------+-------------+---------------+---------------+--------------+-----------
 md5role_auditadmin  | f        | t          | f             | f           | f            | f           | f              | t             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_createdb    | f        | t          | f             | t           | f            | f           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_default     | f        | t          | f             | f           | f            | f           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_inherit     | f        | t          | f             | f           | f            | f           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_login       | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_replication | f        | t          | f             | f           | f            | f           | t              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5role_superuser   | f        | t          | f             | f           | f            | f           | f              | f             | t              |           -1 | ********    |               |               | default_pool | 
 md5user_auditadmin  | f        | t          | f             | f           | f            | t           | f              | t             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_createdb    | f        | t          | f             | t           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_default     | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_inherit     | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_login       | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_replication | f        | t          | f             | f           | f            | t           | t              | f             | f              |           -1 | ********    |               |               | default_pool | 
 md5user_superuser   | f        | t          | f             | f           | f            | t           | f              | f             | t              |           -1 | ********    |               |               | default_pool | 
(14 rows)

	
select rolname    ,
	rolsuper,
	rolinherit,
	rolcreaterole,
	rolcreatedb,
	rolcatupdate,
	rolcanlogin,
	rolreplication,
	rolauditadmin,
	rolsystemadmin,
	rolconnlimit,
	left(rolpassword, 3) = 'md5' as ismd5passwd,
	rolvalidbegin,
	rolvaliduntil,
	rolrespool    
	from pg_authid where rolname ilike 'md5%' order by rolname;
       rolname       | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolreplication | rolauditadmin | rolsystemadmin | rolconnlimit | ismd5passwd | rolvalidbegin | rolvaliduntil |  rolrespool  
---------------------+----------+------------+---------------+-------------+--------------+-------------+----------------+---------------+----------------+--------------+-------------+---------------+---------------+--------------
 md5role_auditadmin  | f        | t          | f             | f           | f            | f           | f              | t             | f              |           -1 | f           |               |               | default_pool
 md5role_createdb    | f        | t          | f             | t           | f            | f           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_default     | f        | t          | f             | f           | f            | f           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_inherit     | f        | t          | f             | f           | f            | f           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_login       | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_replication | f        | t          | f             | f           | f            | f           | t              | f             | f              |           -1 | f           |               |               | default_pool
 md5role_superuser   | f        | t          | f             | f           | f            | f           | f              | f             | t              |           -1 | f           |               |               | default_pool
 md5user_auditadmin  | f        | t          | f             | f           | f            | t           | f              | t             | f              |           -1 | f           |               |               | default_pool
 md5user_createdb    | f        | t          | f             | t           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_default     | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_inherit     | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_login       | f        | t          | f             | f           | f            | t           | f              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_replication | f        | t          | f             | f           | f            | t           | t              | f             | f              |           -1 | f           |               |               | default_pool
 md5user_superuser   | f        | t          | f             | f           | f            | t           | f              | f             | t              |           -1 | f           |               |               | default_pool
(14 rows)

-- Clean
drop user md5user_default cascade;
drop user md5user_superuser cascade;
drop user md5user_createdb cascade;
drop user md5user_login cascade;
drop user md5user_inherit cascade;
drop user md5user_replication cascade;
drop user md5user_auditadmin cascade;
drop role md5role_default ;
drop role md5role_superuser ;
drop role md5role_createdb ;
drop role md5role_login ;
drop role md5role_inherit ;
drop role md5role_replication ;
drop role md5role_auditadmin ;
--audit for set parameter operator.
select * from pg_delete_audit('1111-1-1','2222-2-2');
 pg_delete_audit 
-----------------
 
(1 row)

create user set_role_user password 'gauss@123';
set role set_role_user password 'gauss@123';
reset role;
drop user set_role_user;
select type,result,object_name,detail_info from pg_query_audit('1111-1-1','2222-2-2') where detail_info like '%set_role_user%';
   type   | result |  object_name  |                  detail_info                   
----------+--------+---------------+------------------------------------------------
 ddl_user | ok     | set_role_user | create user set_role_user password '********';
 ddl_user | ok     | set_role_user | drop user set_role_user;
(2 rows)

select * from pg_delete_audit('1111-1-1','2222-2-2');
 pg_delete_audit 
-----------------
 
(1 row)

create user test_rename_user password 'gauss@123';
\! @abs_bindir@/gsql -d postgres -U test_rename_user -W gauss@123 -p @portstring@ -r -c "create table rename_test(id int);"
CREATE TABLE
\! @abs_bindir@/gsql -d postgres -U test_rename_user -W gauss@123 -p @portstring@ -r -c "table rename_test;"
 id 
----
(0 rows)

alter user test_rename_user rename to test_rename_user2;
\! @abs_bindir@/gsql -d postgres -U test_rename_user2 -W gauss@123 -p @portstring@ -r -c "table rename_test;"
 id 
----
(0 rows)

\! @abs_bindir@/gsql -d postgres -U test_rename_user2 -W gauss@123 -p @portstring@ -r -c "alter user test_rename_user2 identified by 'gauss@234' replace 'gauss@123';"
ALTER ROLE
drop user test_rename_user2 cascade;
drop user if exists test_rename_user;
NOTICE:  role "test_rename_user" does not exist, skipping
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -c "create user user01 password 'gauss@123';"
CREATE ROLE
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -c "create user user02 password 'gauss@123';"
CREATE ROLE
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -U user01 -W 'gauss@123' -c "set role user03;"
ERROR:  Invalid username/password,set role denied.
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -U user01 -W 'gauss@123' -c "set role user02;"
ERROR:  permission denied to set role "user02"
drop user user01;
drop user user02;
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -c "create user current_user01 password 'gauss@123';"
CREATE ROLE
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -c "create user current_user02 password 'gauss@123';"
CREATE ROLE
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -U current_user01 -W 'gauss@123' -c "drop user current_user02;"
ERROR:  Permission denied to drop role.
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -U current_user01 -W 'gauss@123' -c "drop user current_user03;"
ERROR:  Permission denied to drop role.
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -U current_user01 -W 'gauss@123' -c "alter user current_user02 sysadmin;"
ERROR:  Permission denied.
\! @abs_bindir@/gsql  -d postgres -p @portstring@ -r -U current_user01 -W 'gauss@123' -c "alter user current_user03 sysadmin;"
ERROR:  Permission denied.
drop user current_user01;
drop user current_user02;
create or replace function isMD5(pwd text) returns bool as $$ begin return left(pwd, 3) = 'md5'; end; $$ language plpgsql;
--alter with admin
create user md5user_default with password 'Gauss@123';
create role md5role_default with password 'Gauss@123';
alter user md5user_default with pguser;	--error
ERROR:  option "pguser" not recognized
alter role md5role_default with pguser;	--error
ERROR:  option "pguser" not recognized
alter user md5user_default with pguser password 'Gauss@1234';
ERROR:  option "pguser" not recognized
alter role md5role_default with pguser password 'Gauss@1234';
ERROR:  option "pguser" not recognized
alter user md5user_default with pguser;	--OK
ERROR:  option "pguser" not recognized
alter role md5role_default with pguser;	--OK
ERROR:  option "pguser" not recognized
select usename, isMD5(passwd) from pg_shadow where usename ilike 'md5%' order by usename;	--md5 now
     usename     | ismd5 
-----------------+-------
 md5user_default | f
(1 row)

select rolname, isMD5(rolpassword) from pg_authid where rolname ilike 'md5%' order by rolname;	--md5 now
     rolname     | ismd5 
-----------------+-------
 md5role_default | f
 md5user_default | f
(2 rows)

alter user md5user_default with password 'Gauss@12345';
alter role md5role_default with password 'Gauss@12345';
select usename, isMD5(passwd) from pg_shadow where usename ilike 'md5%' order by usename;	--md5 still
     usename     | ismd5 
-----------------+-------
 md5user_default | f
(1 row)

select rolname, isMD5(rolpassword) from pg_authid where rolname ilike 'md5%' order by rolname;	--md5 still
     rolname     | ismd5 
-----------------+-------
 md5role_default | f
 md5user_default | f
(2 rows)

drop user md5user_default;
drop role md5role_default;
--alter by userself
create user md5user_default with password 'Gauss@12345';
set role md5user_default password 'Gauss@12345';
alter user md5user_default with pguser;	--error
ERROR:  option "pguser" not recognized
alter user md5user_default with pguser identified by 'Gauss@123456' replace 'Gauss@12344'; --invalid password;
ERROR:  option "pguser" not recognized
alter user md5user_default with pguser identified by 'Gauss@123456' replace 'Gauss@12345'; --OK
ERROR:  option "pguser" not recognized
\c
select usename, isMD5(passwd) from pg_shadow where usename ilike 'md5%' order by usename;	--md5 now
     usename     | ismd5 
-----------------+-------
 md5user_default | f
(1 row)

select rolname, isMD5(rolpassword) from pg_authid where rolname ilike 'md5%' order by rolname;	--md5 now
     rolname     | ismd5 
-----------------+-------
 md5user_default | f
(1 row)

set role md5user_default password 'Gauss@123456';
ERROR:  Invalid username/password,set role denied.
alter user md5user_default with pguser;	--OK
ERROR:  option "pguser" not recognized
alter user md5user_default identified by 'Gauss@123456' replace 'Gauss@12344'; --invalid password;
alter user md5user_default identified by 'Gauss@1234567' replace 'Gauss@123456'; --OK
\c
select usename, isMD5(passwd) from pg_shadow where usename ilike 'md5%' order by usename;	--md5 still
     usename     | ismd5 
-----------------+-------
 md5user_default | f
(1 row)

select rolname, isMD5(rolpassword) from pg_authid where rolname ilike 'md5%' order by rolname;	--md5 still
     rolname     | ismd5 
-----------------+-------
 md5user_default | f
(1 row)

drop user md5user_default cascade;
drop function isMD5;
create user test_createrole_lock_cr with createrole password "Gauss_234";
create user test_createrole_lock_sys with sysadmin password "Gauss_234";
create user test_createrole_lock_audit with auditadmin password "Gauss_234";
\! @abs_bindir@/gsql  -d postgres -p @portstring@  -U test_createrole_lock_cr -W Gauss_234 -c "Alter user test_createrole_lock_sys account lock;"
ERROR:  Permission denied.
\! @abs_bindir@/gsql  -d postgres -p @portstring@  -U test_createrole_lock_cr -W Gauss_234 -c "Alter user test_createrole_lock_audit account lock;"
ALTER ROLE
drop user test_createrole_lock_cr;
drop user test_createrole_lock_sys;
drop user test_createrole_lock_audit;
\h create user
Command:     CREATE USER
Description: define a new database role
Syntax:
CREATE USER [IF NOT EXISTS] user_name [ [ WITH ] option [ ... ] ] [ ENCRYPTED | UNENCRYPTED ] { PASSWORD | IDENTIFIED BY } { 'password' [ EXPIRED ] | DISABLE };

where option can be:
{SYSADMIN | NOSYSADMIN}
    | {MONADMIN | NOMONADMIN}
    | {OPRADMIN | NOOPRADMIN}
    | {POLADMIN | NOPOLADMIN}
    | {AUDITADMIN | NOAUDITADMIN}
    | {CREATEDB | NOCREATEDB}
    | {USEFT | NOUSEFT}
    | {CREATEROLE | NOCREATEROLE}
    | {INHERIT | NOINHERIT}
    | {LOGIN | NOLOGIN}
    | {REPLICATION | NOREPLICATION}
    | {INDEPENDENT | NOINDEPENDENT}
    | {VCADMIN | NOVCADMIN}
    | {PERSISTENCE | NOPERSISTENCE}
    | CONNECTION LIMIT connlimit
    | VALID BEGIN 'timestamp'
    | VALID UNTIL 'timestamp'
    | RESOURCE POOL 'respool'
    | USER GROUP 'groupuser'
    | PERM SPACE 'spacelimit'
    | TEMP SPACE 'tmpspacelimit'
    | SPILL SPACE 'spillspacelimit'
    | NODE GROUP logic_cluster_name
    | IN ROLE role_name [, ...]
    | IN GROUP role_name [, ...]
    | ROLE role_name [, ...]
    | ADMIN role_name [, ...]
    | USER role_name [, ...]
    | SYSID uid
    | DEFAULT TABLESPACE tablespace_name
    | PROFILE DEFAULT
    | PROFILE profile_name
    | PGUSER

\h create role
Command:     CREATE ROLE
Description: define a new database role
Syntax:
CREATE ROLE role_name [ [ WITH ] option [ ... ] ] [ ENCRYPTED | UNENCRYPTED ] { PASSWORD | IDENTIFIED BY } { 'password' [ EXPIRED ] | DISABLE };

where option can be:
{SYSADMIN | NOSYSADMIN}
    | {MONADMIN | NOMONADMIN}
    | {OPRADMIN | NOOPRADMIN}
    | {POLADMIN | NOPOLADMIN}
    | {AUDITADMIN | NOAUDITADMIN}
    | {CREATEDB | NOCREATEDB}
    | {USEFT | NOUSEFT}
    | {CREATEROLE | NOCREATEROLE}
    | {INHERIT | NOINHERIT}
    | {LOGIN | NOLOGIN}
    | {REPLICATION | NOREPLICATION}
    | {INDEPENDENT | NOINDEPENDENT}
    | {VCADMIN | NOVCADMIN}
    | {PERSISTENCE | NOPERSISTENCE}
    | CONNECTION LIMIT connlimit
    | VALID BEGIN 'timestamp'
    | VALID UNTIL 'timestamp'
    | RESOURCE POOL 'respool'
    | USER GROUP 'groupuser'
    | PERM SPACE 'spacelimit'
    | TEMP SPACE 'tmpspacelimit'
    | SPILL SPACE 'spillspacelimit'
    | NODE GROUP logic_cluster_name
    | IN ROLE role_name [, ...]
    | IN GROUP role_name [, ...]
    | ROLE role_name [, ...]
    | ADMIN role_name [, ...]
    | USER role_name [, ...]
    | SYSID uid
    | DEFAULT TABLESPACE tablespace_name
    | PROFILE DEFAULT
    | PROFILE profile_name
    | PGUSER

\h alter user
Command:     ALTER USER
Description: change a database role
Syntax:
ALTER USER [ IF EXISTS ] user_name [ [ WITH ] option [ ... ] ];
ALTER USER user_name
    RENAME TO new_name;
ALTER USER user_name [ IN DATABASE database_name ]
    SET configuration_parameter {{ TO | = } { value | DEFAULT }|FROM CURRENT};
ALTER USER user_name
    [ IN DATABASE database_name ] RESET {configuration_parameter|ALL};

where option can be:
{CREATEDB | NOCREATEDB}
    | {CREATEROLE | NOCREATEROLE}
    | {INHERIT | NOINHERIT}
    | {AUDITADMIN | NOAUDITADMIN}
    | {SYSADMIN | NOSYSADMIN}
    | {MONADMIN | NOMONADMIN}
    | {OPRADMIN | NOOPRADMIN}
    | {POLADMIN | NOPOLADMIN}
    | {USEFT | NOUSEFT}
    | {LOGIN | NOLOGIN}
    | {REPLICATION | NOREPLICATION}
    | {INDEPENDENT | NOINDEPENDENT}
    | {VCADMIN | NOVCADMIN}
    | {PERSISTENCE | NOPERSISTENCE}
    | CONNECTION LIMIT connlimit
    | [ ENCRYPTED | UNENCRYPTED ] PASSWORD { 'password' [ EXPIRED ] | DISABLE | EXPIRED }
    | [ ENCRYPTED | UNENCRYPTED ] IDENTIFIED BY { 'password' [ REPLACE 'old_password' | EXPIRED ] | DISABLE }
    | VALID BEGIN 'timestamp'
    | VALID UNTIL 'timestamp'
    | RESOURCE POOL 'respool'
    | USER GROUP 'groupuser'
    | PERM SPACE 'spacelimit'
    | TEMP SPACE 'tmpspacelimit'
    | SPILL SPACE 'spillspacelimit'
    | NODE GROUP logic_cluster_name
    | ACCOUNT { LOCK | UNLOCK }
    | PGUSER

\h alter role
Command:     ALTER ROLE
Description: change a database role
Syntax:
ALTER ROLE role_name [ [ WITH ] option [ ... ] ];
ALTER ROLE role_name
    RENAME TO new_name;
ALTER ROLE role_name [ IN DATABASE database_name ]
    SET configuration_parameter {{ TO | = } { value | DEFAULT }|FROM CURRENT};
ALTER ROLE role_name
    [ IN DATABASE database_name ] RESET {configuration_parameter|ALL};

where option can be:
{CREATEDB | NOCREATEDB}
    | {CREATEROLE | NOCREATEROLE}
    | {INHERIT | NOINHERIT}
    | {AUDITADMIN | NOAUDITADMIN}
    | {SYSADMIN | NOSYSADMIN}
    | {MONADMIN | NOMONADMIN}
    | {OPRADMIN | NOOPRADMIN}
    | {POLADMIN | NOPOLADMIN}
    | {USEFT | NOUSEFT}
    | {LOGIN | NOLOGIN}
    | {REPLICATION | NOREPLICATION}
    | {INDEPENDENT | NOINDEPENDENT}
    | {VCADMIN | NOVCADMIN}
    | {PERSISTENCE | NOPERSISTENCE}
    | CONNECTION LIMIT connlimit
    | [ ENCRYPTED | UNENCRYPTED ] PASSWORD { 'password' [ EXPIRED ] | DISABLE | EXPIRED }
    | [ ENCRYPTED | UNENCRYPTED ] IDENTIFIED BY { 'password' [ REPLACE 'old_password' | EXPIRED ] | DISABLE }
    | VALID BEGIN 'timestamp'
    | VALID UNTIL 'timestamp'
    | RESOURCE POOL 'respool'
    | USER GROUP 'groupuser'
    | PERM SPACE 'spacelimit'
    | TEMP SPACE 'tmpspacelimit'
    | SPILL SPACE 'spillspacelimit'
    | NODE GROUP logic_cluster_name
    | ACCOUNT { LOCK | UNLOCK }
    | PGUSER

\h create group
Command:     CREATE GROUP
Description: define a new database role
Syntax:
CREATE GROUP group_name [ [ WITH ] option [ ... ] ] [ ENCRYPTED | UNENCRYPTED ] { PASSWORD | IDENTIFIED BY } { 'password' [ EXPIRED ] | DISABLE };

where option can be:
{SYSADMIN | NOSYSADMIN}
    | {MONADMIN | NOMONADMIN}
    | {OPRADMIN | NOOPRADMIN}
    | {POLADMIN | NOPOLADMIN}
    | {AUDITADMIN | NOAUDITADMIN}
    | {CREATEDB | NOCREATEDB}
    | {USEFT | NOUSEFT}
    | {CREATEROLE | NOCREATEROLE}
    | {INHERIT | NOINHERIT}
    | {LOGIN | NOLOGIN}
    | {REPLICATION | NOREPLICATION}
    | {INDEPENDENT | NOINDEPENDENT}
    | {VCADMIN | NOVCADMIN}
    | {PERSISTENCE | NOPERSISTENCE}
    | CONNECTION LIMIT connlimit
    | VALID BEGIN 'timestamp'
    | VALID UNTIL 'timestamp'
    | RESOURCE POOL 'respool'
    | USER GROUP 'groupuser'
    | PERM SPACE 'spacelimit'
    | TEMP SPACE 'tmpspacelimit'
    | SPILL SPACE 'spillspacelimit'
    | NODE GROUP logic_group_name
    | IN ROLE role_name [, ...]
    | IN GROUP role_name [, ...]
    | ROLE role_name [, ...]
    | ADMIN role_name [, ...]
    | USER role_name [, ...]
    | SYSID uid
    | DEFAULT TABLESPACE tablespace_name
    | PROFILE DEFAULT
    | PROFILE profile_name
    | PGUSER

-- Test PG system functions by normal user
create user test_normal_user password 'Gauss@123';
\! @abs_bindir@/gsql  -d postgres -p @portstring@  -U test_normal_user -W Gauss@123 -c "select * from pg_ls_dir('./');"
ERROR:  must be initial account to get directory listings
\! @abs_bindir@/gsql  -d postgres -p @portstring@  -U test_normal_user -W Gauss@123 -c "select * from pg_read_file('tmp.txt');"
ERROR:  must be initial account to read files
\! @abs_bindir@/gsql  -d postgres -p @portstring@  -U test_normal_user -W Gauss@123 -c "select * from pg_read_file('tmp.txt', 2, 9);"
ERROR:  must be initial account to read files
\! @abs_bindir@/gsql  -d postgres -p @portstring@  -U test_normal_user -W Gauss@123 -c "select * from pg_read_binary_file('tmp.txt');"
ERROR:  must be initial account to read files
\! @abs_bindir@/gsql  -d postgres -p @portstring@  -U test_normal_user -W Gauss@123 -c "select * from pg_stat_file('tmp.txt');"
ERROR:  must be initial account to get file information
\! @abs_bindir@/gsql  -d postgres -p @portstring@  -U test_normal_user -W Gauss@123 -c "select * from pg_stat_file_recursive('tmp.txt');"
ERROR:  must be initial account to get file information
drop user test_normal_user cascade;
-- End Test PG system functions
--Test client ecological compatibility with PG
create user md5_compatible_user1 with pguser password 'gauss@123';
create user md5_compatible_user2 password 'md529c2b5b4676f802b4e20e393024e280a';
NOTICE:  Using encrypted password directly now and it is not recommended.
HINT:  The role can't be used if you don't know the original password before encrypted.
create user normal_compatible_user1 password 'gauss@123';
create user normal_compatible_user2 password 'sha25653c72feddf77df9a38f48724531cf74be113f35eaa5c944275d634ed6b4e1225c7d8e77a413478827aadb9632a30a23c18d1c0ed6a82c6c7384acc59439387069dece15b293836a1796a6c5bb1e86d769ecad3a32b42303836ba44da853eea59md5a518c1e222bc618c225a95695b75736c';
NOTICE:  Using encrypted password directly now and it is not recommended.
HINT:  The role can't be used if you don't know the original password before encrypted.
--select length(rolpassword) from pg_authid where rolname = 'md5_compatible_user1';
--select length(rolpassword) from pg_authid where rolname = 'md5_compatible_user2';
--select length(rolpassword) from pg_authid where rolname = 'normal_compatible_user1';
--select length(rolpassword) from pg_authid where rolname = 'normal_compatible_user2';
set role md5_compatible_user1 password 'gauss@123';
reset role;
set role md5_compatible_user2 password 'gauss@123';
reset role;
set role md5_compatible_user2 password 'md529c2b5b4676f802b4e20e393024e280a';
NOTICE:  Using encrypted password directly is not recommended.
alter role md5_compatible_user2 identified by 'md529c2b5b4676f802b4e20e393024e280a' replace 'gauss@123';
ERROR:  Password can't contain more than 32 characters.
alter role md5_compatible_user2 identified by 'Gauss@123' replace 'md529c2b5b4676f802b4e20e393024e280a';
ERROR:  The old password is invalid.
alter role md5_compatible_user2 identified by 'Gauss@123' replace 'gauss@123';
reset role;
--set role normal_compatible_user1 password 'gauss@123';
--reset role;
--set role normal_compatible_user2 password 'gauss@123';
--reset role;
--set role normal_compatible_user2 password 'sha25653c72feddf77df9a38f48724531cf74be113f35eaa5c944275d634ed6b4e1225c7d8e77a413478827aadb9632a30a23c18d1c0ed6a82c6c7384acc59439387069dece15b293836a1796a6c5bb1e86d769ecad3a32b42303836ba44da853eea59md5a518c1e222bc618c225a95695b75736c';
--alter role normal_compatible_user2 identified by 'sha25653c72feddf77df9a38f48724531cf74be113f35eaa5c944275d634ed6b4e1225c7d8e77a413478827aadb9632a30a23c18d1c0ed6a82c6c7384acc59439387069dece15b293836a1796a6c5bb1e86d769ecad3a32b42303836ba44da853eea59md5a518c1e222bc618c225a95695b75736c' replace 'gauss@123';
--alter role normal_compatible_user2 identified by 'Gauss@123' replace 'sha25653c72feddf77df9a38f48724531cf74be113f35eaa5c944275d634ed6b4e1225c7d8e77a413478827aadb9632a30a23c18d1c0ed6a82c6c7384acc59439387069dece15b293836a1796a6c5bb1e86d769ecad3a32b42303836ba44da853eea59md5a518c1e222bc618c225a95695b75736c';
--alter role normal_compatible_user2 identified by 'Gauss@123' replace 'gauss@123';
--reset role;
drop user md5_compatible_user1;
drop user md5_compatible_user2;
drop user normal_compatible_user1;
drop user normal_compatible_user2;
--The supported special character of password are: ~!@#$%^&*()-_=+\\|[{}];:,<.>/?
--create role special_character_password_role password 'gauss""123';
drop role special_character_password_role; 
ERROR:  role "special_character_password_role" does not exist
--test create table for non-eixt/invalid/available schema
create user schematest_user1 password 'Gauss_234';
create schema schematest_schema_1;
set current_schema=schematest_schema_1;
create table schematest_tbtest(a int); drop table schematest_schema_1.schematest_tbtest;
create table schematest_schema_1.schematest_tbtest(a int);  drop table schematest_schema_1.schematest_tbtest;
set current_schema=schema_no_exit;
create table schematest_tbtest(a int);
ERROR:  schema "schema_no_exit" does not exist
create table schema_no_exit.schematest_tbtest(a int);
ERROR:  schema "schema_no_exit" does not exist
set current_schema=schema_no_exit,schematest_schema_1;
create table schematest_tbtest(a int); drop table schematest_schema_1.schematest_tbtest;
--set role schematest_user1 password "Gauss_234";
set current_schema=schematest_schema_1;
create table schematest_tbtest(a int);
create table schematest_schema_1.schematest_tbtest(a int);
ERROR:  relation "schematest_tbtest" already exists in schema "schematest_schema_1"
DETAIL:  creating new table with existing name in the same schema
set current_schema=schema_no_exit;
create table schematest_tbtest(a int);
ERROR:  schema "schema_no_exit" does not exist
create table schema_no_exit.schematest_tbtest(a int);
ERROR:  schema "schema_no_exit" does not exist
set current_schema=schematest_schema_1,schema_no_exit;
create table schematest_tbtest(a int);
ERROR:  relation "schematest_tbtest" already exists in schema "schematest_schema_1"
DETAIL:  creating new table with existing name in the same schema
set current_schema=schematest_schema_1,schematest_user1;
create table schematest_tbtest(a int);
ERROR:  relation "schematest_tbtest" already exists in schema "schematest_schema_1"
DETAIL:  creating new table with existing name in the same schema
drop table schematest_tbtest;
reset role;
drop user if exists  schematest_user1;
drop schema schematest_schema_1;
--test disable gram for iam authenication
create user iam_auth_user01 password disable;
create user iam_auth_user02 identified by disable;
alter user iam_auth_user01 password 'gauss@123';
alter user iam_auth_user02 identified by 'gauss@123';
\! @abs_bindir@/gsql -d postgres -p @portstring@ -U iam_auth_user01 -W gauss@123 -c "alter user iam_auth_user01 password disable;"
ERROR:  Only system admin can disable user's password.
\! @abs_bindir@/gsql -d postgres -p @portstring@ -U iam_auth_user02 -W gauss@123 -c "alter user iam_auth_user02 identified by disable;"
ERROR:  Only system admin can disable user's password.
alter user iam_auth_user01 password disable;
alter user iam_auth_user02 identified by disable;
\! @abs_bindir@/gsql -d postgres -p @portstring@ -U iam_auth_user01 -W gauss@123 -c "\q"
gsql: FATAL:  Invalid username/password,login denied.
\! @abs_bindir@/gsql -d postgres -p @portstring@ -U iam_auth_user02 -W gauss@123 -c "\q"
gsql: FATAL:  Invalid username/password,login denied.
alter user iam_auth_user01 password 'gauss@234';
alter user iam_auth_user02 identified by 'gauss@234' replace 'gauss@34';
drop user iam_auth_user01;
drop user iam_auth_user02;
